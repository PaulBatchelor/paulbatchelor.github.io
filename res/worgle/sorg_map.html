<!DOCTYPE html>
<html lang="en">
<head>

<meta charset="utf-8">
<title>sorg_map</title>

<link rel="stylesheet" href="/css/style.css">

</head>
<body>
<div id="main">
<h1>Code Map</h1>
<a id="sorg.c">
<h2>1 sorg.c</h2>
</a>
<p>sorg.org:15
</p>
<a id="_main_loop_0">
<div><b><i>&lt;&lt;main_loop_0</b></i>&gt;&gt;=</div>
</a>
<p><code>#include&nbsp;&lt;stdio.h&gt;<br>
#include&nbsp;&lt;stdlib.h&gt;<br>
#include&nbsp;&lt;string.h&gt;<br>
#include&nbsp;"parg.h"<br>

</code></p>
<a id="global_variables">
<h3>1.1 global_variables</h3>
</a>
<p>sorg.org:1413
</p>
<a id="_global_variables_0">
<div><b><i>&lt;&lt;global_variables_0</b></i>&gt;&gt;=</div>
</a>
<p><code>static&nbsp;int&nbsp;use_secno&nbsp;=&nbsp;0;<br>

</code></p>
<p>sorg.org:1433
</p>
<a id="_global_variables_1">
<div><b><i>&lt;&lt;global_variables_1</b></i>&gt;&gt;=</div>
</a>
<p><code>static&nbsp;char&nbsp;*indxfile&nbsp;=&nbsp;NULL;<br>
static&nbsp;int&nbsp;mktoc&nbsp;=&nbsp;0;<br>

</code></p>
<a id="enums">
<h3>1.2 enums</h3>
</a>
<p>sorg.org:373
</p>
<a id="_enums_0">
<div><b><i>&lt;&lt;enums_0</b></i>&gt;&gt;=</div>
</a>
<p><code>enum&nbsp;{<br>

</code></p>
<a id="types">
<h4>1.2.1 types</h4>
</a>
<p>sorg.org:613
</p>
<a id="_types_0">
<div><b><i>&lt;&lt;types_0</b></i>&gt;&gt;=</div>
</a>
<p><code>MODE_TEXT,<br>

</code></p>
<p>sorg.org:671
</p>
<a id="_types_1">
<div><b><i>&lt;&lt;types_1</b></i>&gt;&gt;=</div>
</a>
<p><code>MODE_BEGIN_CODE,<br>

</code></p>
<p>sorg.org:738
</p>
<a id="_types_2">
<div><b><i>&lt;&lt;types_2</b></i>&gt;&gt;=</div>
</a>
<p><code>MODE_CODE,<br>

</code></p>
<p>sorg.org:1046
</p>
<a id="_types_3">
<div><b><i>&lt;&lt;types_3</b></i>&gt;&gt;=</div>
</a>
<p><code>MODE_ULIST,<br>

</code></p>
<p>sorg.org:375
</p>
<a id="_enums_2">
<div><b><i>&lt;&lt;enums_2</b></i>&gt;&gt;=</div>
</a>
<p><code>&nbsp;&nbsp;&nbsp;&nbsp;MODE_NONE<br>
};<br>

</code></p>
<a id="sorg_data">
<h3>1.3 sorg_data</h3>
</a>
<p>sorg.org:72
</p>
<a id="_sorg_data_0">
<div><b><i>&lt;&lt;sorg_data_0</b></i>&gt;&gt;=</div>
</a>
<p><code>typedef&nbsp;struct&nbsp;{<br>

</code></p>
<a id="sorg_data_contents">
<h4>1.3.1 sorg_data_contents</h4>
</a>
<p>sorg.org:92
</p>
<a id="_sorg_data_contents_0">
<div><b><i>&lt;&lt;sorg_data_contents_0</b></i>&gt;&gt;=</div>
</a>
<p><code>int&nbsp;mode;<br>

</code></p>
<p>sorg.org:108
</p>
<a id="_sorg_data_contents_1">
<div><b><i>&lt;&lt;sorg_data_contents_1</b></i>&gt;&gt;=</div>
</a>
<p><code>int&nbsp;pmode;<br>

</code></p>
<p>sorg.org:126
</p>
<a id="_sorg_data_contents_2">
<div><b><i>&lt;&lt;sorg_data_contents_2</b></i>&gt;&gt;=</div>
</a>
<p><code>size_t&nbsp;pos;<br>
size_t&nbsp;off;<br>
size_t&nbsp;blksize;<br>

</code></p>
<p>sorg.org:142
</p>
<a id="_sorg_data_contents_3">
<div><b><i>&lt;&lt;sorg_data_contents_3</b></i>&gt;&gt;=</div>
</a>
<p><code>#define&nbsp;SORG_MAXSEC&nbsp;10<br>
int&nbsp;secpos[SORG_MAXSEC];<br>

</code></p>
<p>sorg.org:159
</p>
<a id="_sorg_data_contents_4">
<div><b><i>&lt;&lt;sorg_data_contents_4</b></i>&gt;&gt;=</div>
</a>
<p><code>int&nbsp;depth;<br>
int&nbsp;pdepth;<br>

</code></p>
<p>sorg.org:74
</p>
<a id="_sorg_data_2">
<div><b><i>&lt;&lt;sorg_data_2</b></i>&gt;&gt;=</div>
</a>
<p><code>}&nbsp;sorg_d;<br>

</code></p>
<a id="function_declarations">
<h3>1.4 function_declarations</h3>
</a>
<p>sorg.org:196
</p>
<a id="_function_declarations_0">
<div><b><i>&lt;&lt;function_declarations_0</b></i>&gt;&gt;=</div>
</a>
<p><code>static&nbsp;int&nbsp;parse(sorg_d&nbsp;*sorg,&nbsp;FILE&nbsp;*out,&nbsp;char&nbsp;*buf,&nbsp;size_t&nbsp;size);<br>

</code></p>
<p>sorg.org:386
</p>
<a id="_function_declarations_1">
<div><b><i>&lt;&lt;function_declarations_1</b></i>&gt;&gt;=</div>
</a>
<p><code>static&nbsp;int&nbsp;is_header(sorg_d&nbsp;*sorg,&nbsp;char&nbsp;*buf,&nbsp;size_t&nbsp;size);<br>

</code></p>
<p>sorg.org:422
</p>
<a id="_function_declarations_2">
<div><b><i>&lt;&lt;function_declarations_2</b></i>&gt;&gt;=</div>
</a>
<p><code>static&nbsp;void&nbsp;print_header(sorg_d&nbsp;*sorg,&nbsp;char&nbsp;*buf,&nbsp;size_t&nbsp;size,&nbsp;FILE&nbsp;*out);<br>

</code></p>
<p>sorg.org:541
</p>
<a id="_function_declarations_3">
<div><b><i>&lt;&lt;function_declarations_3</b></i>&gt;&gt;=</div>
</a>
<p><code>static&nbsp;int&nbsp;is_title(sorg_d&nbsp;*sorg,&nbsp;const&nbsp;char&nbsp;*buf,&nbsp;size_t&nbsp;size);<br>

</code></p>
<p>sorg.org:563
</p>
<a id="_function_declarations_4">
<div><b><i>&lt;&lt;function_declarations_4</b></i>&gt;&gt;=</div>
</a>
<p><code>static&nbsp;void&nbsp;print_title(sorg_d&nbsp;*sorg,&nbsp;const&nbsp;char&nbsp;*buf,&nbsp;size_t&nbsp;size,&nbsp;FILE&nbsp;*out);<br>

</code></p>
<p>sorg.org:619
</p>
<a id="_function_declarations_5">
<div><b><i>&lt;&lt;function_declarations_5</b></i>&gt;&gt;=</div>
</a>
<p><code>void&nbsp;print_text(sorg_d&nbsp;*sorg,&nbsp;char&nbsp;*buf,&nbsp;FILE&nbsp;*out);<br>

</code></p>
<p>sorg.org:645
</p>
<a id="_function_declarations_6">
<div><b><i>&lt;&lt;function_declarations_6</b></i>&gt;&gt;=</div>
</a>
<p><code>static&nbsp;int&nbsp;is_name(sorg_d&nbsp;*sorg,&nbsp;char&nbsp;*buf,&nbsp;size_t&nbsp;size);<br>

</code></p>
<p>sorg.org:685
</p>
<a id="_function_declarations_7">
<div><b><i>&lt;&lt;function_declarations_7</b></i>&gt;&gt;=</div>
</a>
<p><code>static&nbsp;void&nbsp;print_name(sorg_d&nbsp;*sorg,&nbsp;char&nbsp;*buf,&nbsp;size_t&nbsp;size,&nbsp;FILE&nbsp;*out);<br>

</code></p>
<p>sorg.org:745
</p>
<a id="_function_declarations_8">
<div><b><i>&lt;&lt;function_declarations_8</b></i>&gt;&gt;=</div>
</a>
<p><code>static&nbsp;int&nbsp;is_begin(sorg_d&nbsp;*sorg,&nbsp;char&nbsp;*buf,&nbsp;size_t&nbsp;size);<br>

</code></p>
<p>sorg.org:772
</p>
<a id="_function_declarations_9">
<div><b><i>&lt;&lt;function_declarations_9</b></i>&gt;&gt;=</div>
</a>
<p><code>static&nbsp;int&nbsp;is_end(sorg_d&nbsp;*sorg,&nbsp;char&nbsp;*buf,&nbsp;size_t&nbsp;size);<br>

</code></p>
<p>sorg.org:801
</p>
<a id="_function_declarations_10">
<div><b><i>&lt;&lt;function_declarations_10</b></i>&gt;&gt;=</div>
</a>
<p><code>static&nbsp;int&nbsp;is_block_ref(sorg_d&nbsp;*sorg,&nbsp;char&nbsp;*buf,&nbsp;size_t&nbsp;size);<br>

</code></p>
<p>sorg.org:834
</p>
<a id="_function_declarations_11">
<div><b><i>&lt;&lt;function_declarations_11</b></i>&gt;&gt;=</div>
</a>
<p><code>static&nbsp;size_t&nbsp;print_block_ref(sorg_d&nbsp;*sorg,&nbsp;char&nbsp;*buf,&nbsp;size_t&nbsp;size,&nbsp;FILE&nbsp;*out);<br>

</code></p>
<p>sorg.org:891
</p>
<a id="_function_declarations_12">
<div><b><i>&lt;&lt;function_declarations_12</b></i>&gt;&gt;=</div>
</a>
<p><code>static&nbsp;int&nbsp;is_encapsulated(sorg_d&nbsp;*sorg,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;const&nbsp;char&nbsp;*delim,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;dsize,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;char&nbsp;*buf,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;size_t&nbsp;size);<br>

</code></p>
<p>sorg.org:919
</p>
<a id="_function_declarations_13">
<div><b><i>&lt;&lt;function_declarations_13</b></i>&gt;&gt;=</div>
</a>
<p><code>static&nbsp;size_t&nbsp;print_encapsulated(sorg_d&nbsp;*sorg,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;const&nbsp;char&nbsp;*delim,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;dsize,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;char&nbsp;*buf,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;size_t&nbsp;size,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;const&nbsp;char&nbsp;*tag,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FILE&nbsp;*out);<br>

</code></p>
<p>sorg.org:969
</p>
<a id="_function_declarations_14">
<div><b><i>&lt;&lt;function_declarations_14</b></i>&gt;&gt;=</div>
</a>
<p><code>static&nbsp;int&nbsp;chk_encapsulated(sorg_d&nbsp;*sorg,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;const&nbsp;char&nbsp;*delim,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;dsize,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;char&nbsp;*buf,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;size_t&nbsp;size,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;const&nbsp;char&nbsp;*tag,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FILE&nbsp;*out);<br>

</code></p>
<p>sorg.org:1063
</p>
<a id="_function_declarations_15">
<div><b><i>&lt;&lt;function_declarations_15</b></i>&gt;&gt;=</div>
</a>
<p><code>static&nbsp;int&nbsp;is_ulistitem(sorg_d&nbsp;*sorg,&nbsp;char&nbsp;*buf,&nbsp;size_t&nbsp;size);<br>

</code></p>
<p>sorg.org:1085
</p>
<a id="_function_declarations_16">
<div><b><i>&lt;&lt;function_declarations_16</b></i>&gt;&gt;=</div>
</a>
<p><code>static&nbsp;void&nbsp;print_ulist_begin(sorg_d&nbsp;*sorg,&nbsp;FILE&nbsp;*out);<br>

</code></p>
<p>sorg.org:1101
</p>
<a id="_function_declarations_17">
<div><b><i>&lt;&lt;function_declarations_17</b></i>&gt;&gt;=</div>
</a>
<p><code>static&nbsp;void&nbsp;print_ulist_end(sorg_d&nbsp;*sorg,&nbsp;FILE&nbsp;*out);<br>

</code></p>
<p>sorg.org:1116
</p>
<a id="_function_declarations_18">
<div><b><i>&lt;&lt;function_declarations_18</b></i>&gt;&gt;=</div>
</a>
<p><code>static&nbsp;void&nbsp;print_ulist_item(sorg_d&nbsp;*sorg,&nbsp;char&nbsp;*buf,&nbsp;size_t&nbsp;size,&nbsp;FILE&nbsp;*out);<br>

</code></p>
<p>sorg.org:1194
</p>
<a id="_function_declarations_19">
<div><b><i>&lt;&lt;function_declarations_19</b></i>&gt;&gt;=</div>
</a>
<p><code>static&nbsp;int&nbsp;is_link(sorg_d&nbsp;*sorg,&nbsp;char&nbsp;*buf,&nbsp;size_t&nbsp;size);<br>

</code></p>
<p>sorg.org:1219
</p>
<a id="_function_declarations_20">
<div><b><i>&lt;&lt;function_declarations_20</b></i>&gt;&gt;=</div>
</a>
<p><code>static&nbsp;size_t&nbsp;print_link(sorg_d&nbsp;*sorg,&nbsp;char&nbsp;*buf,&nbsp;size_t&nbsp;size,&nbsp;FILE&nbsp;*out);<br>

</code></p>
<p>sorg.org:1277
</p>
<a id="_function_declarations_21">
<div><b><i>&lt;&lt;function_declarations_21</b></i>&gt;&gt;=</div>
</a>
<p><code>static&nbsp;int&nbsp;is_comment(sorg_d&nbsp;*sorg,&nbsp;char&nbsp;*line,&nbsp;size_t&nbsp;size);<br>

</code></p>
<p>sorg.org:1315
</p>
<a id="_function_declarations_22">
<div><b><i>&lt;&lt;function_declarations_22</b></i>&gt;&gt;=</div>
</a>
<p><code>static&nbsp;void&nbsp;update_section_depth(sorg_d&nbsp;*sorg,&nbsp;int&nbsp;depth);<br>

</code></p>
<p>sorg.org:1347
</p>
<a id="_function_declarations_23">
<div><b><i>&lt;&lt;function_declarations_23</b></i>&gt;&gt;=</div>
</a>
<p><code>static&nbsp;void&nbsp;print_section(sorg_d&nbsp;*sorg,&nbsp;FILE&nbsp;*out);<br>

</code></p>
<p>sorg.org:1519
</p>
<a id="_function_declarations_24">
<div><b><i>&lt;&lt;function_declarations_24</b></i>&gt;&gt;=</div>
</a>
<p><code>static&nbsp;void&nbsp;spaces_to_underscores(const&nbsp;char&nbsp;*str,&nbsp;size_t&nbsp;size,&nbsp;FILE&nbsp;*out);<br>

</code></p>
<a id="functions">
<h3>1.5 functions</h3>
</a>
<p>sorg.org:81
</p>
<a id="_functions_0">
<div><b><i>&lt;&lt;functions_0</b></i>&gt;&gt;=</div>
</a>
<p><code>void&nbsp;sorg_init(sorg_d&nbsp;*sorg)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;i;<br>

</code></p>
<a id="initialize_stuff">
<h4>1.5.1 initialize_stuff</h4>
</a>
<p>sorg.org:100
</p>
<a id="_initialize_stuff_0">
<div><b><i>&lt;&lt;initialize_stuff_0</b></i>&gt;&gt;=</div>
</a>
<p><code>sorg-&gt;mode&nbsp;=&nbsp;MODE_NONE;<br>

</code></p>
<p>sorg.org:115
</p>
<a id="_initialize_stuff_1">
<div><b><i>&lt;&lt;initialize_stuff_1</b></i>&gt;&gt;=</div>
</a>
<p><code>sorg-&gt;pmode&nbsp;=&nbsp;MODE_NONE;<br>

</code></p>
<p>sorg.org:133
</p>
<a id="_initialize_stuff_2">
<div><b><i>&lt;&lt;initialize_stuff_2</b></i>&gt;&gt;=</div>
</a>
<p><code>sorg-&gt;pos&nbsp;=&nbsp;0;<br>
sorg-&gt;off&nbsp;=&nbsp;0;<br>
sorg-&gt;blksize&nbsp;=&nbsp;0;<br>

</code></p>
<p>sorg.org:150
</p>
<a id="_initialize_stuff_3">
<div><b><i>&lt;&lt;initialize_stuff_3</b></i>&gt;&gt;=</div>
</a>
<p><code>for(i&nbsp;=&nbsp;0;&nbsp;i&nbsp;&lt;&nbsp;SORG_MAXSEC;&nbsp;i++)&nbsp;sorg-&gt;secpos[i]&nbsp;=&nbsp;0;<br>

</code></p>
<p>sorg.org:171
</p>
<a id="_initialize_stuff_4">
<div><b><i>&lt;&lt;initialize_stuff_4</b></i>&gt;&gt;=</div>
</a>
<p><code>sorg-&gt;depth&nbsp;=&nbsp;-1;<br>
sorg-&gt;pdepth&nbsp;=&nbsp;-1;<br>

</code></p>
<p>sorg.org:84
</p>
<a id="_functions_2">
<div><b><i>&lt;&lt;functions_2</b></i>&gt;&gt;=</div>
</a>
<p><code>}<br>

</code></p>
<p>sorg.org:391
</p>
<a id="_functions_3">
<div><b><i>&lt;&lt;functions_3</b></i>&gt;&gt;=</div>
</a>
<p><code>static&nbsp;int&nbsp;is_header(sorg_d&nbsp;*sorg,&nbsp;char&nbsp;*buf,&nbsp;size_t&nbsp;size)<br>
{<br>
&nbsp;&nbsp;&nbsp;&nbsp;size_t&nbsp;s;<br>
&nbsp;&nbsp;&nbsp;&nbsp;if(size&nbsp;==&nbsp;0)&nbsp;return&nbsp;0;<br>
&nbsp;&nbsp;&nbsp;&nbsp;if(buf[0]&nbsp;!=&nbsp;'*')&nbsp;return&nbsp;0;<br>
&nbsp;&nbsp;&nbsp;&nbsp;for(s&nbsp;=&nbsp;1;&nbsp;s&nbsp;&lt;&nbsp;size;&nbsp;s++)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(buf[s]&nbsp;==&nbsp;'*')&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;continue;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;if(buf[s]&nbsp;==&nbsp;'&nbsp;')&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;1;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;0;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;0;<br>
}<br>

</code></p>
<p>sorg.org:427
</p>
<a id="_functions_4">
<div><b><i>&lt;&lt;functions_4</b></i>&gt;&gt;=</div>
</a>
<p><code>static&nbsp;void&nbsp;print_header(sorg_d&nbsp;*sorg,&nbsp;char&nbsp;*buf,&nbsp;size_t&nbsp;size,&nbsp;FILE&nbsp;*out)<br>
{<br>
&nbsp;&nbsp;&nbsp;&nbsp;size_t&nbsp;s;<br>
&nbsp;&nbsp;&nbsp;&nbsp;size_t&nbsp;off;<br>
&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;mode;<br>
&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;level;<br>
&nbsp;&nbsp;&nbsp;&nbsp;off&nbsp;=&nbsp;0;<br>
&nbsp;&nbsp;&nbsp;&nbsp;mode&nbsp;=&nbsp;0;<br>
&nbsp;&nbsp;&nbsp;&nbsp;level&nbsp;=&nbsp;1;<br>
&nbsp;&nbsp;&nbsp;&nbsp;for(s&nbsp;=&nbsp;0;&nbsp;s&nbsp;&lt;&nbsp;size;&nbsp;s++)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(mode&nbsp;==&nbsp;2)&nbsp;break;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;switch(mode)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;0:&nbsp;/*&nbsp;asterisks&nbsp;*/<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(buf[off]&nbsp;!=&nbsp;'*')&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mode&nbsp;=&nbsp;1;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;off++;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;level++;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;off++;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;1:&nbsp;/*&nbsp;spaces&nbsp;*/<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(buf[off]&nbsp;!=&nbsp;'&nbsp;')&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mode&nbsp;=&nbsp;2;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;if(buf[size&nbsp;-&nbsp;1]&nbsp;==&nbsp;'\n')&nbsp;size--;&nbsp;/*&nbsp;chomp&nbsp;*/<br>

</code></p>
<a id="update_section_depth">
<h4>1.5.2 update_section_depth</h4>
</a>
<p>sorg.org:477
</p>
<a id="_update_section_depth_0">
<div><b><i>&lt;&lt;update_section_depth_0</b></i>&gt;&gt;=</div>
</a>
<p><code>update_section_depth(sorg,&nbsp;level&nbsp;-&nbsp;2);<br>

</code></p>
<p>sorg.org:459
</p>
<a id="_functions_6">
<div><b><i>&lt;&lt;functions_6</b></i>&gt;&gt;=</div>
</a>
<p><code>&nbsp;&nbsp;&nbsp;&nbsp;if(mktoc)&nbsp;{<br>

</code></p>
<a id="print_toc_header">
<h4>1.5.3 print_toc_header</h4>
</a>
<p>sorg.org:520
</p>
<a id="_print_toc_header_0">
<div><b><i>&lt;&lt;print_toc_header_0</b></i>&gt;&gt;=</div>
</a>
<p><code>if(sorg-&gt;depth&nbsp;&gt;&nbsp;sorg-&gt;pdepth)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;fprintf(out,&nbsp;"&lt;ul&gt;");<br>
}&nbsp;else&nbsp;if(sorg-&gt;depth&nbsp;&lt;&nbsp;sorg-&gt;pdepth)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;for(s&nbsp;=&nbsp;0;&nbsp;s&nbsp;&lt;&nbsp;(sorg-&gt;pdepth&nbsp;-&nbsp;sorg-&gt;depth);&nbsp;s++)<br>
&nbsp;&nbsp;&nbsp;&nbsp;fprintf(out,&nbsp;"&lt;/ul&gt;");<br>
}<br>
fprintf(out,&nbsp;"&lt;li&gt;&lt;a&nbsp;href=\"%s#",&nbsp;indxfile);<br>
spaces_to_underscores(buf&nbsp;+&nbsp;off,&nbsp;size&nbsp;-&nbsp;off,&nbsp;out);<br>
fprintf(out,&nbsp;"\"&gt;");<br>
if(use_secno)&nbsp;print_section(sorg,&nbsp;out);<br>
fwrite(buf&nbsp;+&nbsp;off,&nbsp;1,&nbsp;size&nbsp;-&nbsp;off,&nbsp;out);<br>
fprintf(out,&nbsp;"&lt;/a&gt;&lt;/li&gt;\n");<br>

</code></p>
<p>sorg.org:461
</p>
<a id="_functions_8">
<div><b><i>&lt;&lt;functions_8</b></i>&gt;&gt;=</div>
</a>
<p><code>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br>

</code></p>
<a id="print_normal_header">
<h4>1.5.4 print_normal_header</h4>
</a>
<p>sorg.org:482
</p>
<a id="_print_normal_header_0">
<div><b><i>&lt;&lt;print_normal_header_0</b></i>&gt;&gt;=</div>
</a>
<p><code>fprintf(out,&nbsp;"&lt;a&nbsp;id=\"");<br>
spaces_to_underscores(buf&nbsp;+&nbsp;off,&nbsp;size&nbsp;-&nbsp;off,&nbsp;out);<br>
fprintf(out,&nbsp;"\"&gt;\n");<br>
if(level&nbsp;&lt;&nbsp;6)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;fprintf(out,&nbsp;"&lt;h%d&gt;",&nbsp;level);<br>
&nbsp;&nbsp;&nbsp;&nbsp;if(use_secno)&nbsp;print_section(sorg,&nbsp;out);<br>
&nbsp;&nbsp;&nbsp;&nbsp;fwrite(buf&nbsp;+&nbsp;off,&nbsp;1,&nbsp;size&nbsp;-&nbsp;off,&nbsp;out);<br>
&nbsp;&nbsp;&nbsp;&nbsp;fprintf(out,&nbsp;"&lt;/h%d&gt;\n",&nbsp;level);<br>
}&nbsp;else&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;fprintf(out,&nbsp;"&lt;u&gt;&lt;i&gt;");<br>
&nbsp;&nbsp;&nbsp;&nbsp;if(use_secno)&nbsp;print_section(sorg,&nbsp;out);<br>
&nbsp;&nbsp;&nbsp;&nbsp;fwrite(buf&nbsp;+&nbsp;off,&nbsp;1,&nbsp;size&nbsp;-&nbsp;off,&nbsp;out);<br>
&nbsp;&nbsp;&nbsp;&nbsp;fprintf(out,&nbsp;"&lt;/i&gt;&lt;/u&gt;\n");<br>
}<br>
fprintf(out,&nbsp;"&lt;/a&gt;\n");<br>

</code></p>
<p>sorg.org:463
</p>
<a id="_functions_10">
<div><b><i>&lt;&lt;functions_10</b></i>&gt;&gt;=</div>
</a>
<p><code>&nbsp;&nbsp;&nbsp;&nbsp;}<br>
}<br>

</code></p>
<p>sorg.org:546
</p>
<a id="_functions_11">
<div><b><i>&lt;&lt;functions_11</b></i>&gt;&gt;=</div>
</a>
<p><code>static&nbsp;int&nbsp;is_title(sorg_d&nbsp;*sorg,&nbsp;const&nbsp;char&nbsp;*buf,&nbsp;size_t&nbsp;size)<br>
{<br>
&nbsp;&nbsp;&nbsp;&nbsp;const&nbsp;char&nbsp;*title&nbsp;=&nbsp;"#+TITLE:";<br>
&nbsp;&nbsp;&nbsp;&nbsp;size_t&nbsp;title_size&nbsp;=&nbsp;8;<br>
&nbsp;&nbsp;&nbsp;&nbsp;size_t&nbsp;s;<br>
&nbsp;&nbsp;&nbsp;&nbsp;if(size&nbsp;&lt;&nbsp;title_size)&nbsp;return&nbsp;0;<br>
&nbsp;&nbsp;&nbsp;&nbsp;for(s&nbsp;=&nbsp;0;&nbsp;s&nbsp;&lt;&nbsp;title_size;&nbsp;s++)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(buf[s]&nbsp;!=&nbsp;title[s])&nbsp;return&nbsp;0;<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;1;<br>
}<br>

</code></p>
<p>sorg.org:568
</p>
<a id="_functions_12">
<div><b><i>&lt;&lt;functions_12</b></i>&gt;&gt;=</div>
</a>
<p><code>static&nbsp;void&nbsp;print_title(sorg_d&nbsp;*sorg,&nbsp;const&nbsp;char&nbsp;*buf,&nbsp;size_t&nbsp;size,&nbsp;FILE&nbsp;*out)<br>
{<br>
&nbsp;&nbsp;&nbsp;&nbsp;size_t&nbsp;s;<br>
&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;mode;<br>
&nbsp;&nbsp;&nbsp;&nbsp;const&nbsp;char&nbsp;*title;<br>
&nbsp;&nbsp;&nbsp;&nbsp;size_t&nbsp;tsize;<br>
&nbsp;&nbsp;&nbsp;&nbsp;mode&nbsp;=&nbsp;1;<br>
&nbsp;&nbsp;&nbsp;&nbsp;tsize&nbsp;=&nbsp;0;<br>
&nbsp;&nbsp;&nbsp;&nbsp;title&nbsp;=&nbsp;NULL;<br>
&nbsp;&nbsp;&nbsp;&nbsp;for(s&nbsp;=&nbsp;8;&nbsp;s&nbsp;&lt;&nbsp;size;&nbsp;s++)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(mode&nbsp;==&nbsp;0)&nbsp;break;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;switch(mode)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;1:&nbsp;/*&nbsp;spaces&nbsp;*/<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(buf[s]&nbsp;==&nbsp;'&nbsp;')&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;continue;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mode&nbsp;=&nbsp;2;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tsize&nbsp;=&nbsp;1;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;title&nbsp;=&nbsp;&buf[s];<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;2:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(buf[s]&nbsp;==&nbsp;'\n')&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mode&nbsp;=&nbsp;0;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tsize++;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;if(title&nbsp;!=&nbsp;NULL)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fprintf(out,&nbsp;"&lt;h1&gt;");<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fwrite(title,&nbsp;1,&nbsp;tsize,&nbsp;out);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fprintf(out,&nbsp;"&lt;/h1&gt;\n");<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
}<br>

</code></p>
<p>sorg.org:626
</p>
<a id="_functions_13">
<div><b><i>&lt;&lt;functions_13</b></i>&gt;&gt;=</div>
</a>
<p><code>void&nbsp;print_text(sorg_d&nbsp;*sorg,&nbsp;char&nbsp;*buf,&nbsp;FILE&nbsp;*out)<br>
{<br>
&nbsp;&nbsp;&nbsp;&nbsp;if(sorg-&gt;blksize&nbsp;&gt;&nbsp;0)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf("are&nbsp;we&nbsp;here?\n");<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fwrite(buf&nbsp;+&nbsp;sorg-&gt;off,&nbsp;1,&nbsp;sorg-&gt;blksize&nbsp;-&nbsp;1,&nbsp;out);<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
}<br>

</code></p>
<p>sorg.org:650
</p>
<a id="_functions_14">
<div><b><i>&lt;&lt;functions_14</b></i>&gt;&gt;=</div>
</a>
<p><code>static&nbsp;int&nbsp;is_name(sorg_d&nbsp;*sorg,&nbsp;char&nbsp;*buf,&nbsp;size_t&nbsp;size)<br>
{<br>
&nbsp;&nbsp;&nbsp;&nbsp;const&nbsp;char&nbsp;*name&nbsp;=&nbsp;"#+NAME:";<br>
&nbsp;&nbsp;&nbsp;&nbsp;const&nbsp;int&nbsp;name_size&nbsp;=&nbsp;7;<br>
&nbsp;&nbsp;&nbsp;&nbsp;size_t&nbsp;s;<br>
&nbsp;&nbsp;&nbsp;&nbsp;if(size&nbsp;&lt;&nbsp;name_size)&nbsp;return&nbsp;0;<br>
&nbsp;&nbsp;&nbsp;&nbsp;for(s&nbsp;=&nbsp;0;&nbsp;s&nbsp;&lt;&nbsp;name_size;&nbsp;s++)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(buf[s]&nbsp;!=&nbsp;name[s])&nbsp;return&nbsp;0;<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;1;<br>
}<br>

</code></p>
<p>sorg.org:690
</p>
<a id="_functions_15">
<div><b><i>&lt;&lt;functions_15</b></i>&gt;&gt;=</div>
</a>
<p><code>static&nbsp;void&nbsp;print_name(sorg_d&nbsp;*sorg,&nbsp;char&nbsp;*buf,&nbsp;size_t&nbsp;size,&nbsp;FILE&nbsp;*out)<br>
{<br>
&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;mode;<br>
&nbsp;&nbsp;&nbsp;&nbsp;size_t&nbsp;name_size;<br>
&nbsp;&nbsp;&nbsp;&nbsp;size_t&nbsp;n;<br>
&nbsp;&nbsp;&nbsp;&nbsp;size_t&nbsp;off;<br>
&nbsp;&nbsp;&nbsp;&nbsp;buf+=7;<br>
&nbsp;&nbsp;&nbsp;&nbsp;size&nbsp;-=&nbsp;7;<br>
&nbsp;&nbsp;&nbsp;&nbsp;name_size&nbsp;=&nbsp;0;<br>
&nbsp;&nbsp;&nbsp;&nbsp;mode&nbsp;=&nbsp;1;<br>
&nbsp;&nbsp;&nbsp;&nbsp;off&nbsp;=&nbsp;0;<br>
&nbsp;&nbsp;&nbsp;&nbsp;for(n&nbsp;=&nbsp;0;&nbsp;n&nbsp;&lt;&nbsp;size;&nbsp;n++)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(mode&nbsp;==&nbsp;0)&nbsp;break;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;switch(mode)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;1:&nbsp;/*&nbsp;spaces&nbsp;*/<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(buf[n]&nbsp;==&nbsp;'&nbsp;')&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;off&nbsp;=&nbsp;n;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mode&nbsp;=&nbsp;2;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name_size&nbsp;=&nbsp;1;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;2:&nbsp;/*&nbsp;count&nbsp;to&nbsp;line&nbsp;break*/<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(buf[n]&nbsp;==&nbsp;'\n'&nbsp;||&nbsp;buf[n]&nbsp;==&nbsp;'&nbsp;')&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mode&nbsp;=&nbsp;0;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name_size++;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;fprintf(out,&nbsp;"&lt;a&nbsp;id=\"_");<br>
&nbsp;&nbsp;&nbsp;&nbsp;spaces_to_underscores(buf&nbsp;+&nbsp;off,&nbsp;name_size,&nbsp;out);<br>
&nbsp;&nbsp;&nbsp;&nbsp;fprintf(out,&nbsp;"\"&gt;\n");<br>
&nbsp;&nbsp;&nbsp;&nbsp;fprintf(out,&nbsp;"&lt;div&gt;&lt;b&gt;&lt;i&gt;&lt;&lt;");<br>
&nbsp;&nbsp;&nbsp;&nbsp;fwrite(buf&nbsp;+&nbsp;off,&nbsp;1,&nbsp;name_size,&nbsp;out);<br>
&nbsp;&nbsp;&nbsp;&nbsp;fprintf(out,&nbsp;"&lt;/b&gt;&lt;/i&gt;&gt;&gt;=&lt;/div&gt;\n");<br>
&nbsp;&nbsp;&nbsp;&nbsp;fprintf(out,&nbsp;"&lt;/a&gt;");<br>
}<br>

</code></p>
<p>sorg.org:750
</p>
<a id="_functions_16">
<div><b><i>&lt;&lt;functions_16</b></i>&gt;&gt;=</div>
</a>
<p><code>static&nbsp;int&nbsp;is_begin(sorg_d&nbsp;*sorg,&nbsp;char&nbsp;*buf,&nbsp;size_t&nbsp;size)<br>
{<br>
&nbsp;&nbsp;&nbsp;&nbsp;const&nbsp;char&nbsp;*name&nbsp;=&nbsp;"#+BEGIN_SRC";<br>
&nbsp;&nbsp;&nbsp;&nbsp;const&nbsp;int&nbsp;name_size&nbsp;=&nbsp;11;<br>
&nbsp;&nbsp;&nbsp;&nbsp;size_t&nbsp;s;<br>
&nbsp;&nbsp;&nbsp;&nbsp;if(size&nbsp;&lt;&nbsp;name_size)&nbsp;return&nbsp;0;<br>
&nbsp;&nbsp;&nbsp;&nbsp;for(s&nbsp;=&nbsp;0;&nbsp;s&nbsp;&lt;&nbsp;name_size;&nbsp;s++)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(buf[s]&nbsp;!=&nbsp;name[s])&nbsp;return&nbsp;0;<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;1;<br>
}<br>

</code></p>
<p>sorg.org:777
</p>
<a id="_functions_17">
<div><b><i>&lt;&lt;functions_17</b></i>&gt;&gt;=</div>
</a>
<p><code>static&nbsp;int&nbsp;is_end(sorg_d&nbsp;*sorg,&nbsp;char&nbsp;*buf,&nbsp;size_t&nbsp;size)<br>
{<br>
&nbsp;&nbsp;&nbsp;&nbsp;const&nbsp;char&nbsp;*name&nbsp;=&nbsp;"#+END_SRC";<br>
&nbsp;&nbsp;&nbsp;&nbsp;const&nbsp;int&nbsp;name_size&nbsp;=&nbsp;9;<br>
&nbsp;&nbsp;&nbsp;&nbsp;size_t&nbsp;s;<br>
&nbsp;&nbsp;&nbsp;&nbsp;if(size&nbsp;&lt;&nbsp;name_size)&nbsp;return&nbsp;0;<br>
&nbsp;&nbsp;&nbsp;&nbsp;for(s&nbsp;=&nbsp;0;&nbsp;s&nbsp;&lt;&nbsp;name_size;&nbsp;s++)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(buf[s]&nbsp;!=&nbsp;name[s])&nbsp;return&nbsp;0;<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;1;<br>
}<br>

</code></p>
<p>sorg.org:811
</p>
<a id="_functions_18">
<div><b><i>&lt;&lt;functions_18</b></i>&gt;&gt;=</div>
</a>
<p><code>static&nbsp;int&nbsp;is_block_ref(sorg_d&nbsp;*sorg,&nbsp;char&nbsp;*buf,&nbsp;size_t&nbsp;size)<br>
{<br>
&nbsp;&nbsp;&nbsp;&nbsp;size_t&nbsp;n;<br>
&nbsp;&nbsp;&nbsp;&nbsp;if(size&nbsp;&lt;&nbsp;5)&nbsp;return&nbsp;0;<br>
&nbsp;&nbsp;&nbsp;&nbsp;if(buf[0]&nbsp;!=&nbsp;'&lt;'&nbsp;||&nbsp;buf[1]&nbsp;!=&nbsp;'&lt;')&nbsp;return&nbsp;0;<br>
&nbsp;&nbsp;&nbsp;&nbsp;size&nbsp;-=&nbsp;1;&nbsp;/*&nbsp;for&nbsp;lookahead&nbsp;*/<br>
&nbsp;&nbsp;&nbsp;&nbsp;for(n&nbsp;=&nbsp;2;&nbsp;n&nbsp;&lt;&nbsp;size;&nbsp;n++)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(buf[n]&nbsp;==&nbsp;'&gt;'&nbsp;&&&nbsp;buf[n&nbsp;+&nbsp;1]&nbsp;==&nbsp;'&gt;')&nbsp;return&nbsp;1;<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;0;<br>
}<br>

</code></p>
<p>sorg.org:843
</p>
<a id="_functions_19">
<div><b><i>&lt;&lt;functions_19</b></i>&gt;&gt;=</div>
</a>
<p><code>static&nbsp;size_t&nbsp;print_block_ref(sorg_d&nbsp;*sorg,&nbsp;char&nbsp;*buf,&nbsp;size_t&nbsp;size,&nbsp;FILE&nbsp;*out)<br>
{<br>
&nbsp;&nbsp;&nbsp;&nbsp;size_t&nbsp;off;<br>
&nbsp;&nbsp;&nbsp;&nbsp;size_t&nbsp;n;<br>
&nbsp;&nbsp;&nbsp;&nbsp;char&nbsp;*name;<br>
&nbsp;&nbsp;&nbsp;&nbsp;size_t&nbsp;name_size;<br>
&nbsp;&nbsp;&nbsp;&nbsp;size_t&nbsp;tmp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;size&nbsp;-=&nbsp;1;&nbsp;/*&nbsp;for&nbsp;lookahead&nbsp;*/<br>
&nbsp;&nbsp;&nbsp;&nbsp;off&nbsp;=&nbsp;2;<br>
&nbsp;&nbsp;&nbsp;&nbsp;name_size&nbsp;=&nbsp;0;<br>
&nbsp;&nbsp;&nbsp;&nbsp;tmp&nbsp;=&nbsp;0;<br>
&nbsp;&nbsp;&nbsp;&nbsp;name&nbsp;=&nbsp;&buf[2];<br>
&nbsp;&nbsp;&nbsp;&nbsp;for(n&nbsp;=&nbsp;2;&nbsp;n&nbsp;&lt;&nbsp;size;&nbsp;n++)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;off++;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tmp++;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(buf[n]&nbsp;==&nbsp;'&gt;'&nbsp;&&&nbsp;buf[n&nbsp;+&nbsp;1]&nbsp;==&nbsp;'&gt;')&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name_size&nbsp;=&nbsp;tmp&nbsp;-&nbsp;1;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;n++;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;off++;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;fprintf(out,&nbsp;"&lt;a&nbsp;href=\"#_");<br>
&nbsp;&nbsp;&nbsp;&nbsp;spaces_to_underscores(name,&nbsp;name_size,&nbsp;out);<br>
&nbsp;&nbsp;&nbsp;&nbsp;fprintf(out,&nbsp;"\"&gt;&lt;&lt;");<br>
&nbsp;&nbsp;&nbsp;&nbsp;fwrite(name,&nbsp;1,&nbsp;name_size,&nbsp;out);<br>
&nbsp;&nbsp;&nbsp;&nbsp;fprintf(out,&nbsp;"&gt;&gt;&lt;/a&gt;");<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;off;<br>
}<br>

</code></p>
<p>sorg.org:900
</p>
<a id="_functions_20">
<div><b><i>&lt;&lt;functions_20</b></i>&gt;&gt;=</div>
</a>
<p><code>static&nbsp;int&nbsp;is_encapsulated(sorg_d&nbsp;*sorg,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;const&nbsp;char&nbsp;*delim,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;dsize,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;char&nbsp;*buf,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;size_t&nbsp;size)<br>
{<br>
&nbsp;&nbsp;&nbsp;&nbsp;size_t&nbsp;s;<br>
&nbsp;&nbsp;&nbsp;&nbsp;if(buf[0]&nbsp;!=&nbsp;delim[0])&nbsp;return&nbsp;0;<br>
&nbsp;&nbsp;&nbsp;&nbsp;size&nbsp;=&nbsp;size&nbsp;-&nbsp;1;<br>
&nbsp;&nbsp;&nbsp;&nbsp;for(s&nbsp;=&nbsp;1;&nbsp;s&nbsp;&lt;&nbsp;size;&nbsp;s++)&nbsp;if(buf[s]&nbsp;==&nbsp;delim[0])&nbsp;return&nbsp;1;<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;0;<br>
}<br>

</code></p>
<p>sorg.org:936
</p>
<a id="_functions_21">
<div><b><i>&lt;&lt;functions_21</b></i>&gt;&gt;=</div>
</a>
<p><code>static&nbsp;size_t&nbsp;print_encapsulated(sorg_d&nbsp;*sorg,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;const&nbsp;char&nbsp;*delim,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;dsize,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;char&nbsp;*buf,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;size_t&nbsp;size,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;const&nbsp;char&nbsp;*tag,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FILE&nbsp;*out)<br>
{<br>
&nbsp;&nbsp;&nbsp;&nbsp;size_t&nbsp;off;<br>
&nbsp;&nbsp;&nbsp;&nbsp;size_t&nbsp;s;<br>
&nbsp;&nbsp;&nbsp;&nbsp;off&nbsp;=&nbsp;1;<br>
&nbsp;&nbsp;&nbsp;&nbsp;size&nbsp;=&nbsp;size&nbsp;-&nbsp;1;<br>
&nbsp;&nbsp;&nbsp;&nbsp;for(s&nbsp;=&nbsp;1;&nbsp;s&nbsp;&lt;&nbsp;size;&nbsp;s++)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;off++;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(buf[s]&nbsp;==&nbsp;delim[0])&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;fprintf(out,&nbsp;"&lt;%s&gt;",&nbsp;tag);<br>
&nbsp;&nbsp;&nbsp;&nbsp;fwrite(buf&nbsp;+&nbsp;dsize,&nbsp;1,&nbsp;off&nbsp;-&nbsp;2*dsize,&nbsp;out);<br>
&nbsp;&nbsp;&nbsp;&nbsp;fprintf(out,&nbsp;"&lt;/%s&gt;",&nbsp;tag);<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;off;<br>
}<br>

</code></p>
<p>sorg.org:980
</p>
<a id="_functions_22">
<div><b><i>&lt;&lt;functions_22</b></i>&gt;&gt;=</div>
</a>
<p><code>static&nbsp;int&nbsp;chk_encapsulated(sorg_d&nbsp;*sorg,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;const&nbsp;char&nbsp;*delim,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;dsize,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;char&nbsp;*buf,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;size_t&nbsp;size,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;const&nbsp;char&nbsp;*tag,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FILE&nbsp;*out)<br>
{<br>
&nbsp;&nbsp;&nbsp;&nbsp;if(is_encapsulated(sorg,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;delim,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dsize,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&buf[sorg-&gt;pos],<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;size&nbsp;-&nbsp;sorg-&gt;pos))<br>
&nbsp;&nbsp;&nbsp;&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fwrite(buf&nbsp;+&nbsp;sorg-&gt;off,&nbsp;1,&nbsp;sorg-&gt;blksize&nbsp;-&nbsp;1,&nbsp;out);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sorg-&gt;pos&nbsp;+=&nbsp;print_encapsulated(sorg,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;delim,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dsize,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&buf[sorg-&gt;pos],<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;size&nbsp;-&nbsp;sorg-&gt;pos,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tag,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;out);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sorg-&gt;blksize&nbsp;=&nbsp;1;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sorg-&gt;off&nbsp;=&nbsp;sorg-&gt;pos;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;1;<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;0;<br>
}<br>

</code></p>
<p>sorg.org:1068
</p>
<a id="_functions_23">
<div><b><i>&lt;&lt;functions_23</b></i>&gt;&gt;=</div>
</a>
<p><code>static&nbsp;int&nbsp;is_ulistitem(sorg_d&nbsp;*sorg,&nbsp;char&nbsp;*buf,&nbsp;size_t&nbsp;size)<br>
{<br>
&nbsp;&nbsp;&nbsp;&nbsp;if(size&nbsp;==&nbsp;0)&nbsp;return&nbsp;0;<br>
&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;if(buf[0]&nbsp;!=&nbsp;'-')&nbsp;return&nbsp;0;<br>
&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;if(size&nbsp;==&nbsp;2&nbsp;&&&nbsp;buf[0]&nbsp;==&nbsp;'-')&nbsp;return&nbsp;1;<br>
&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;if(buf[0]&nbsp;==&nbsp;'-'&nbsp;&&&nbsp;buf[1]&nbsp;==&nbsp;'&nbsp;')&nbsp;return&nbsp;1;<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;0;<br>
}<br>

</code></p>
<p>sorg.org:1090
</p>
<a id="_functions_24">
<div><b><i>&lt;&lt;functions_24</b></i>&gt;&gt;=</div>
</a>
<p><code>static&nbsp;void&nbsp;print_ulist_begin(sorg_d&nbsp;*sorg,&nbsp;FILE&nbsp;*out)<br>
{<br>
&nbsp;&nbsp;&nbsp;&nbsp;fprintf(out,&nbsp;"&lt;ul&gt;\n");<br>
}<br>

</code></p>
<p>sorg.org:1106
</p>
<a id="_functions_25">
<div><b><i>&lt;&lt;functions_25</b></i>&gt;&gt;=</div>
</a>
<p><code>static&nbsp;void&nbsp;print_ulist_end(sorg_d&nbsp;*sorg,&nbsp;FILE&nbsp;*out)<br>
{<br>
&nbsp;&nbsp;&nbsp;&nbsp;fprintf(out,&nbsp;"&lt;/ul&gt;\n");<br>
}<br>

</code></p>
<p>sorg.org:1140
</p>
<a id="_functions_26">
<div><b><i>&lt;&lt;functions_26</b></i>&gt;&gt;=</div>
</a>
<p><code>static&nbsp;void&nbsp;print_ulist_item(sorg_d&nbsp;*sorg,&nbsp;char&nbsp;*buf,&nbsp;size_t&nbsp;size,&nbsp;FILE&nbsp;*out)<br>
{<br>
&nbsp;&nbsp;&nbsp;&nbsp;size_t&nbsp;s;<br>
&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;mode;<br>
&nbsp;&nbsp;&nbsp;&nbsp;size_t&nbsp;off;<br>
&nbsp;&nbsp;&nbsp;&nbsp;size_t&nbsp;len;<br>
&nbsp;&nbsp;&nbsp;&nbsp;size_t&nbsp;s_blksize;<br>
&nbsp;&nbsp;&nbsp;&nbsp;size_t&nbsp;s_off;<br>
&nbsp;&nbsp;&nbsp;&nbsp;size_t&nbsp;s_pos;<br>
&nbsp;&nbsp;&nbsp;&nbsp;mode&nbsp;=&nbsp;1;<br>
&nbsp;&nbsp;&nbsp;&nbsp;off&nbsp;=&nbsp;1;&nbsp;/*&nbsp;assume&nbsp;first&nbsp;character&nbsp;is&nbsp;'-'&nbsp;*/<br>
&nbsp;&nbsp;&nbsp;&nbsp;len&nbsp;=&nbsp;0;<br>
&nbsp;&nbsp;&nbsp;&nbsp;for(s&nbsp;=&nbsp;1;&nbsp;s&nbsp;&lt;&nbsp;size;&nbsp;s++)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(mode&nbsp;==&nbsp;0)&nbsp;break;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;switch(mode)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;1:&nbsp;/*&nbsp;whitespaces&nbsp;after&nbsp;initial&nbsp;dash&nbsp;*/<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(buf[s]&nbsp;!=&nbsp;'&nbsp;')&nbsp;mode&nbsp;=&nbsp;2;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;off++;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;2:&nbsp;/*&nbsp;look&nbsp;for&nbsp;linebreak&nbsp;*/<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(buf[s]&nbsp;==&nbsp;'\n')&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mode&nbsp;=&nbsp;0;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;len++;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;fprintf(out,&nbsp;"&lt;li&gt;&lt;p&gt;");<br>
&nbsp;&nbsp;&nbsp;&nbsp;sorg-&gt;pmode&nbsp;=&nbsp;MODE_NONE;<br>
&nbsp;&nbsp;&nbsp;&nbsp;sorg-&gt;mode&nbsp;=&nbsp;MODE_TEXT;<br>
&nbsp;&nbsp;&nbsp;&nbsp;s_off&nbsp;=&nbsp;sorg-&gt;off;<br>
&nbsp;&nbsp;&nbsp;&nbsp;s_blksize&nbsp;=&nbsp;sorg-&gt;blksize;<br>
&nbsp;&nbsp;&nbsp;&nbsp;s_pos&nbsp;=&nbsp;sorg-&gt;pos;<br>
&nbsp;&nbsp;&nbsp;&nbsp;parse(sorg,&nbsp;out,&nbsp;buf&nbsp;+&nbsp;off,&nbsp;len&nbsp;+&nbsp;1);<br>
&nbsp;&nbsp;&nbsp;&nbsp;sorg-&gt;off&nbsp;=&nbsp;s_off;<br>
&nbsp;&nbsp;&nbsp;&nbsp;sorg-&gt;blksize&nbsp;=&nbsp;s_blksize;<br>
&nbsp;&nbsp;&nbsp;&nbsp;sorg-&gt;pos&nbsp;=&nbsp;s_pos;<br>
&nbsp;&nbsp;&nbsp;&nbsp;sorg-&gt;mode&nbsp;=&nbsp;MODE_ULIST;<br>
&nbsp;&nbsp;&nbsp;&nbsp;sorg-&gt;pmode&nbsp;=&nbsp;MODE_ULIST;<br>
&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;fwrite(buf&nbsp;+&nbsp;off,&nbsp;len,&nbsp;1,&nbsp;out);&nbsp;*/<br>
&nbsp;&nbsp;&nbsp;&nbsp;fprintf(out,&nbsp;"&lt;/p&gt;&lt;/li&gt;\n");<br>
}<br>

</code></p>
<p>sorg.org:1199
</p>
<a id="_functions_27">
<div><b><i>&lt;&lt;functions_27</b></i>&gt;&gt;=</div>
</a>
<p><code>static&nbsp;int&nbsp;is_link(sorg_d&nbsp;*sorg,&nbsp;char&nbsp;*buf,&nbsp;size_t&nbsp;size)<br>
{<br>
&nbsp;&nbsp;&nbsp;&nbsp;size_t&nbsp;n;<br>
&nbsp;&nbsp;&nbsp;&nbsp;if(size&nbsp;&lt;&nbsp;5)&nbsp;return&nbsp;0;<br>
&nbsp;&nbsp;&nbsp;&nbsp;if(buf[0]&nbsp;!=&nbsp;'['&nbsp;||&nbsp;buf[1]&nbsp;!=&nbsp;'[')&nbsp;return&nbsp;0;<br>
&nbsp;&nbsp;&nbsp;&nbsp;size&nbsp;-=&nbsp;1;&nbsp;/*&nbsp;for&nbsp;lookahead&nbsp;*/<br>
&nbsp;&nbsp;&nbsp;&nbsp;for(n&nbsp;=&nbsp;2;&nbsp;n&nbsp;&lt;&nbsp;size;&nbsp;n++)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(buf[n]&nbsp;==&nbsp;']'&nbsp;&&&nbsp;buf[n&nbsp;+&nbsp;1]&nbsp;==&nbsp;']')&nbsp;return&nbsp;1;<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;0;<br>
}<br>

</code></p>
<p>sorg.org:1224
</p>
<a id="_functions_28">
<div><b><i>&lt;&lt;functions_28</b></i>&gt;&gt;=</div>
</a>
<p><code>static&nbsp;size_t&nbsp;print_link(sorg_d&nbsp;*sorg,&nbsp;char&nbsp;*buf,&nbsp;size_t&nbsp;size,&nbsp;FILE&nbsp;*out)<br>
{<br>
&nbsp;&nbsp;&nbsp;&nbsp;size_t&nbsp;off;<br>
&nbsp;&nbsp;&nbsp;&nbsp;size_t&nbsp;n;<br>
&nbsp;&nbsp;&nbsp;&nbsp;char&nbsp;*link;<br>
&nbsp;&nbsp;&nbsp;&nbsp;size_t&nbsp;link_size;<br>
&nbsp;&nbsp;&nbsp;&nbsp;char&nbsp;*name;<br>
&nbsp;&nbsp;&nbsp;&nbsp;size_t&nbsp;name_size;<br>
&nbsp;&nbsp;&nbsp;&nbsp;size_t&nbsp;tmp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;size&nbsp;-=&nbsp;1;&nbsp;/*&nbsp;for&nbsp;lookahead&nbsp;*/<br>
&nbsp;&nbsp;&nbsp;&nbsp;off&nbsp;=&nbsp;2;<br>
&nbsp;&nbsp;&nbsp;&nbsp;name_size&nbsp;=&nbsp;0;<br>
&nbsp;&nbsp;&nbsp;&nbsp;link_size&nbsp;=&nbsp;0;<br>
&nbsp;&nbsp;&nbsp;&nbsp;tmp&nbsp;=&nbsp;0;<br>
&nbsp;&nbsp;&nbsp;&nbsp;link&nbsp;=&nbsp;NULL;<br>
&nbsp;&nbsp;&nbsp;&nbsp;name&nbsp;=&nbsp;NULL;<br>
&nbsp;&nbsp;&nbsp;&nbsp;link&nbsp;=&nbsp;&buf[2];<br>
&nbsp;&nbsp;&nbsp;&nbsp;for(n&nbsp;=&nbsp;2;&nbsp;n&nbsp;&lt;&nbsp;size;&nbsp;n++)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;off++;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tmp++;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(buf[n]&nbsp;==&nbsp;']'&nbsp;&&&nbsp;buf[n&nbsp;+&nbsp;1]&nbsp;==&nbsp;'[')&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;link_size&nbsp;=&nbsp;tmp&nbsp;-&nbsp;1;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tmp&nbsp;=&nbsp;0;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name&nbsp;=&nbsp;&buf[n&nbsp;+&nbsp;2];<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;n++;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;off++;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;if(buf[n]&nbsp;==&nbsp;']'&nbsp;&&&nbsp;buf[n&nbsp;+&nbsp;1]&nbsp;==&nbsp;']')&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name_size&nbsp;=&nbsp;tmp&nbsp;-&nbsp;1;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;off++;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;if(!strncmp(link,&nbsp;"https://",&nbsp;8)&nbsp;||&nbsp;!strncmp(link,&nbsp;"http://",&nbsp;7))&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fprintf(out,&nbsp;"&lt;a&nbsp;href=\"");<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fwrite(link,&nbsp;1,&nbsp;link_size,&nbsp;out);<br>
&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fprintf(out,&nbsp;"&lt;a&nbsp;href=\"#");<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;spaces_to_underscores(link,&nbsp;link_size,&nbsp;out);<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;fprintf(out,&nbsp;"\"&gt;");<br>
&nbsp;&nbsp;&nbsp;&nbsp;fwrite(name,&nbsp;1,&nbsp;name_size,&nbsp;out);<br>
&nbsp;&nbsp;&nbsp;&nbsp;fprintf(out,&nbsp;"&lt;/a&gt;");<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;off;<br>
}<br>

</code></p>
<p>sorg.org:1286
</p>
<a id="_functions_29">
<div><b><i>&lt;&lt;functions_29</b></i>&gt;&gt;=</div>
</a>
<p><code>static&nbsp;int&nbsp;is_comment(sorg_d&nbsp;*sorg,&nbsp;char&nbsp;*line,&nbsp;size_t&nbsp;size)<br>
{<br>
&nbsp;&nbsp;&nbsp;&nbsp;if(size&nbsp;&lt;=&nbsp;0)&nbsp;return&nbsp;0;<br>
&nbsp;&nbsp;&nbsp;&nbsp;if(size&nbsp;==&nbsp;2&nbsp;&&&nbsp;line[0]&nbsp;==&nbsp;'#')&nbsp;return&nbsp;1;<br>
&nbsp;&nbsp;&nbsp;&nbsp;if(line[0]&nbsp;==&nbsp;'#'&nbsp;&&&nbsp;line[1]&nbsp;==&nbsp;'&nbsp;')&nbsp;return&nbsp;1;<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;0;<br>
}<br>

</code></p>
<p>sorg.org:1320
</p>
<a id="_functions_30">
<div><b><i>&lt;&lt;functions_30</b></i>&gt;&gt;=</div>
</a>
<p><code>static&nbsp;void&nbsp;update_section_depth(sorg_d&nbsp;*sorg,&nbsp;int&nbsp;depth)<br>
{<br>
&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;i;<br>
&nbsp;&nbsp;&nbsp;&nbsp;if(depth&nbsp;&lt;&nbsp;0&nbsp;&&&nbsp;depth&nbsp;&gt;&nbsp;SORG_MAXSEC)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fprintf(stderr,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"Warning:&nbsp;section&nbsp;depth&nbsp;of&nbsp;%d&nbsp;exceeds&nbsp;maximum&nbsp;depth&nbsp;of&nbsp;%d\n",<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;depth&nbsp;+&nbsp;1,&nbsp;SORG_MAXSEC);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return;<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;if(depth&nbsp;&gt;&nbsp;sorg-&gt;depth)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sorg-&gt;secpos[depth]&nbsp;=&nbsp;1;<br>
&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;if(depth&nbsp;&lt;&nbsp;sorg-&gt;depth)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sorg-&gt;secpos[depth]++;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for(i&nbsp;=&nbsp;depth&nbsp;+&nbsp;1;&nbsp;i&nbsp;&lt;&nbsp;SORG_MAXSEC;&nbsp;i++)&nbsp;sorg-&gt;secpos[i]&nbsp;=&nbsp;0;<br>
&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sorg-&gt;secpos[depth]++;<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;sorg-&gt;pdepth&nbsp;=&nbsp;sorg-&gt;depth;<br>
&nbsp;&nbsp;&nbsp;&nbsp;sorg-&gt;depth&nbsp;=&nbsp;depth;<br>
}<br>

</code></p>
<p>sorg.org:1355
</p>
<a id="_functions_31">
<div><b><i>&lt;&lt;functions_31</b></i>&gt;&gt;=</div>
</a>
<p><code>static&nbsp;void&nbsp;print_section(sorg_d&nbsp;*sorg,&nbsp;FILE&nbsp;*out)<br>
{<br>
&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;i;<br>
&nbsp;&nbsp;&nbsp;&nbsp;if(sorg-&gt;depth&nbsp;&lt;&nbsp;0)&nbsp;return;<br>
&nbsp;&nbsp;&nbsp;&nbsp;fprintf(out,&nbsp;"%d",&nbsp;sorg-&gt;secpos[0]);<br>
&nbsp;&nbsp;&nbsp;&nbsp;for(i&nbsp;=&nbsp;1;&nbsp;i&nbsp;&lt;=&nbsp;sorg-&gt;depth;&nbsp;i++)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fprintf(out,&nbsp;".%d",&nbsp;sorg-&gt;secpos[i]);<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;fputc('&nbsp;',&nbsp;out);<br>
}<br>

</code></p>
<p>sorg.org:1524
</p>
<a id="_functions_32">
<div><b><i>&lt;&lt;functions_32</b></i>&gt;&gt;=</div>
</a>
<p><code>static&nbsp;void&nbsp;spaces_to_underscores(const&nbsp;char&nbsp;*str,&nbsp;size_t&nbsp;size,&nbsp;FILE&nbsp;*out)<br>
{<br>
&nbsp;&nbsp;&nbsp;&nbsp;size_t&nbsp;blksize;<br>
&nbsp;&nbsp;&nbsp;&nbsp;size_t&nbsp;n;<br>
&nbsp;&nbsp;&nbsp;&nbsp;size_t&nbsp;off;<br>
&nbsp;&nbsp;&nbsp;&nbsp;off&nbsp;=&nbsp;0;<br>
&nbsp;&nbsp;&nbsp;&nbsp;blksize&nbsp;=&nbsp;0;<br>
&nbsp;&nbsp;&nbsp;&nbsp;for(n&nbsp;=&nbsp;0;&nbsp;n&nbsp;&lt;&nbsp;size;&nbsp;n++)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;blksize++;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(str[n]&nbsp;==&nbsp;'&nbsp;')&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fwrite(str&nbsp;+&nbsp;off,&nbsp;1,&nbsp;blksize&nbsp;-&nbsp;1,&nbsp;out);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fputc('_',&nbsp;out);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;blksize&nbsp;=&nbsp;0;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;off&nbsp;=&nbsp;n&nbsp;+&nbsp;1;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;fwrite(str&nbsp;+&nbsp;off,&nbsp;1,&nbsp;blksize,&nbsp;out);<br>
}<br>

</code></p>
<a id="parsing_top">
<h3>1.6 parsing_top</h3>
</a>
<p>sorg.org:201
</p>
<a id="_parsing_top_0">
<div><b><i>&lt;&lt;parsing_top_0</b></i>&gt;&gt;=</div>
</a>
<p><code>static&nbsp;int&nbsp;parse(sorg_d&nbsp;*sorg,&nbsp;FILE&nbsp;*out,&nbsp;char&nbsp;*buf,&nbsp;size_t&nbsp;size)<br>
{<br>
&nbsp;&nbsp;&nbsp;&nbsp;sorg-&gt;pos&nbsp;=&nbsp;0;<br>
&nbsp;&nbsp;&nbsp;&nbsp;sorg-&gt;off&nbsp;=&nbsp;0;<br>
&nbsp;&nbsp;&nbsp;&nbsp;sorg-&gt;blksize&nbsp;=&nbsp;0;<br>
&nbsp;&nbsp;&nbsp;&nbsp;if(mktoc)&nbsp;{<br>

</code></p>
<a id="toc_parse_mode">
<h4>1.6.1 toc_parse_mode</h4>
</a>
<p>sorg.org:360
</p>
<a id="_toc_parse_mode_0">
<div><b><i>&lt;&lt;toc_parse_mode_0</b></i>&gt;&gt;=</div>
</a>
<p><code>if(buf[0]&nbsp;==&nbsp;'\n')&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;1;<br>
}<br>
if(is_title(sorg,&nbsp;buf,&nbsp;size))&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;print_title(sorg,&nbsp;buf,&nbsp;size,&nbsp;out);<br>
}else&nbsp;if(is_header(sorg,&nbsp;buf,&nbsp;size))&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;print_header(sorg,&nbsp;buf,&nbsp;size,&nbsp;out);<br>
}<br>

</code></p>
<p>sorg.org:208
</p>
<a id="_parsing_top_2">
<div><b><i>&lt;&lt;parsing_top_2</b></i>&gt;&gt;=</div>
</a>
<p><code>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br>

</code></p>
<a id="normal_parse_mode">
<h4>1.6.2 normal_parse_mode</h4>
</a>
<p>sorg.org:218
</p>
<a id="_normal_parse_mode_0">
<div><b><i>&lt;&lt;normal_parse_mode_0</b></i>&gt;&gt;=</div>
</a>
<p><code>if(buf[0]&nbsp;==&nbsp;'\n')&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;if(sorg-&gt;pmode&nbsp;==&nbsp;MODE_TEXT)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fprintf(out,"&lt;/p&gt;\n");<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sorg-&gt;pmode&nbsp;=&nbsp;MODE_NONE;<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;1;<br>
}<br>
while(sorg-&gt;pos&nbsp;&lt;&nbsp;size)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;switch(sorg-&gt;mode)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;MODE_NONE:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(is_comment(sorg,&nbsp;buf,&nbsp;size))&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sorg-&gt;mode&nbsp;=&nbsp;MODE_NONE;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;1;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;if(is_header(sorg,&nbsp;buf,&nbsp;size))&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(sorg-&gt;pmode&nbsp;==&nbsp;MODE_TEXT)&nbsp;fprintf(out,&nbsp;"&lt;/p&gt;\n");<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print_header(sorg,&nbsp;buf,&nbsp;size,&nbsp;out);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sorg-&gt;mode&nbsp;=&nbsp;MODE_NONE;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sorg-&gt;pmode&nbsp;=&nbsp;sorg-&gt;mode;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;1;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;if(is_name(sorg,&nbsp;buf,&nbsp;size))&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(sorg-&gt;pmode&nbsp;==&nbsp;MODE_TEXT)&nbsp;fprintf(out,&nbsp;"&lt;/p&gt;\n");<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print_name(sorg,&nbsp;buf,&nbsp;size,&nbsp;out);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sorg-&gt;mode&nbsp;=&nbsp;MODE_BEGIN_CODE;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sorg-&gt;pmode&nbsp;=&nbsp;sorg-&gt;mode;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;1;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;if(is_title(sorg,&nbsp;buf,&nbsp;size))&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(sorg-&gt;pmode&nbsp;==&nbsp;MODE_TEXT)&nbsp;fprintf(out,&nbsp;"&lt;/p&gt;\n");<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print_title(sorg,&nbsp;buf,&nbsp;size,&nbsp;out);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sorg-&gt;mode&nbsp;=&nbsp;MODE_NONE;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sorg-&gt;pmode&nbsp;=&nbsp;sorg-&gt;mode;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;1;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;if(is_ulistitem(sorg,&nbsp;buf,&nbsp;size))&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(sorg-&gt;pmode&nbsp;==&nbsp;MODE_TEXT)&nbsp;fprintf(out,&nbsp;"&lt;/p&gt;\n");<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print_ulist_begin(sorg,&nbsp;out);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print_ulist_item(sorg,&nbsp;buf,&nbsp;size,&nbsp;out);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sorg-&gt;pmode&nbsp;=&nbsp;sorg-&gt;mode;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sorg-&gt;mode&nbsp;=&nbsp;MODE_ULIST;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;1;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sorg-&gt;mode&nbsp;=&nbsp;MODE_TEXT;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sorg-&gt;off&nbsp;=&nbsp;sorg-&gt;pos;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sorg-&gt;blksize&nbsp;=&nbsp;1;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(sorg-&gt;pmode&nbsp;!=&nbsp;MODE_TEXT)&nbsp;fprintf(out,&nbsp;"&lt;p&gt;");<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;MODE_TEXT:<br>

</code></p>
<a id="parse_formatted">
<h5>1.6.2.1 parse_formatted</h5>
</a>
<p>sorg.org:1016
</p>
<a id="_parse_formatted_0">
<div><b><i>&lt;&lt;parse_formatted_0</b></i>&gt;&gt;=</div>
</a>
<p><code>if(chk_encapsulated(sorg,&nbsp;"*",&nbsp;1,&nbsp;buf,&nbsp;size,&nbsp;"b",&nbsp;out))&nbsp;break;<br>

</code></p>
<p>sorg.org:1022
</p>
<a id="_parse_formatted_1">
<div><b><i>&lt;&lt;parse_formatted_1</b></i>&gt;&gt;=</div>
</a>
<p><code>if(chk_encapsulated(sorg,&nbsp;"/",&nbsp;1,&nbsp;buf,&nbsp;size,&nbsp;"i",&nbsp;out))&nbsp;break;<br>

</code></p>
<p>sorg.org:1028
</p>
<a id="_parse_formatted_2">
<div><b><i>&lt;&lt;parse_formatted_2</b></i>&gt;&gt;=</div>
</a>
<p><code>if(chk_encapsulated(sorg,&nbsp;"=",&nbsp;1,&nbsp;buf,&nbsp;size,&nbsp;"code",&nbsp;out))&nbsp;break;<br>

</code></p>
<p>sorg.org:1033
</p>
<a id="_parse_formatted_3">
<div><b><i>&lt;&lt;parse_formatted_3</b></i>&gt;&gt;=</div>
</a>
<p><code>if(chk_encapsulated(sorg,&nbsp;"_",&nbsp;1,&nbsp;buf,&nbsp;size,&nbsp;"u",&nbsp;out))&nbsp;break;<br>

</code></p>
<p>sorg.org:266
</p>
<a id="_normal_parse_mode_2">
<div><b><i>&lt;&lt;normal_parse_mode_2</b></i>&gt;&gt;=</div>
</a>
<p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(is_link(sorg,&nbsp;&buf[sorg-&gt;pos],&nbsp;size&nbsp;-&nbsp;sorg-&gt;pos))&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print_text(sorg,&nbsp;buf,&nbsp;out);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sorg-&gt;pos&nbsp;+=&nbsp;print_link(sorg,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&buf[sorg-&gt;pos],<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;size&nbsp;-&nbsp;sorg-&gt;pos,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;out);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sorg-&gt;blksize&nbsp;=&nbsp;1;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sorg-&gt;off&nbsp;=&nbsp;sorg-&gt;pos;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;if(is_block_ref(sorg,&nbsp;&buf[sorg-&gt;pos],&nbsp;size&nbsp;-&nbsp;sorg-&gt;pos))&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print_text(sorg,&nbsp;buf,&nbsp;out);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sorg-&gt;pos&nbsp;+=&nbsp;print_block_ref(sorg,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&buf[sorg-&gt;pos],<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;size&nbsp;-&nbsp;sorg-&gt;pos,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;out);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sorg-&gt;blksize&nbsp;=&nbsp;1;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sorg-&gt;off&nbsp;=&nbsp;sorg-&gt;pos;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(buf[sorg-&gt;pos]&nbsp;!=&nbsp;'\n')&nbsp;sorg-&gt;blksize++;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sorg-&gt;pos++;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;MODE_BEGIN_CODE:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!is_begin(sorg,&nbsp;buf,&nbsp;size))&nbsp;return&nbsp;0;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fprintf(out,&nbsp;"\n&lt;p&gt;&lt;code&gt;");<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sorg-&gt;mode&nbsp;=&nbsp;MODE_CODE;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;1;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;MODE_CODE:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(is_end(sorg,&nbsp;buf,&nbsp;size))&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sorg-&gt;mode&nbsp;=&nbsp;MODE_NONE;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fprintf(out,&nbsp;"\n&lt;/code&gt;&lt;/p&gt;\n");<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;1;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sorg-&gt;blksize++;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;switch(buf[sorg-&gt;pos])&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;'&lt;':<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fwrite(buf&nbsp;+&nbsp;sorg-&gt;off,&nbsp;1,&nbsp;sorg-&gt;blksize&nbsp;-&nbsp;1,&nbsp;out);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sorg-&gt;off&nbsp;=&nbsp;sorg-&gt;pos&nbsp;+&nbsp;1;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sorg-&gt;blksize&nbsp;=&nbsp;0;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fprintf(out,&nbsp;"&lt;");<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;'&gt;':<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fwrite(buf&nbsp;+&nbsp;sorg-&gt;off,&nbsp;1,&nbsp;sorg-&gt;blksize&nbsp;-&nbsp;1,&nbsp;out);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sorg-&gt;off&nbsp;=&nbsp;sorg-&gt;pos&nbsp;+&nbsp;1;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sorg-&gt;blksize&nbsp;=&nbsp;0;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fprintf(out,&nbsp;"&gt;");<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;'\n':<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fwrite(buf&nbsp;+&nbsp;sorg-&gt;off,&nbsp;1,&nbsp;sorg-&gt;blksize&nbsp;-&nbsp;1,&nbsp;out);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sorg-&gt;off&nbsp;=&nbsp;sorg-&gt;pos&nbsp;+&nbsp;1;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sorg-&gt;blksize&nbsp;=&nbsp;0;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fprintf(out,&nbsp;"&lt;br&gt;\n");<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;'&nbsp;':<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fwrite(buf&nbsp;+&nbsp;sorg-&gt;off,&nbsp;1,&nbsp;sorg-&gt;blksize&nbsp;-&nbsp;1,&nbsp;out);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sorg-&gt;off&nbsp;=&nbsp;sorg-&gt;pos&nbsp;+&nbsp;1;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sorg-&gt;blksize&nbsp;=&nbsp;0;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fprintf(out,&nbsp;"&nbsp;");<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sorg-&gt;pos++;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;MODE_ULIST:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(is_ulistitem(sorg,&nbsp;buf,&nbsp;size))&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print_ulist_item(sorg,&nbsp;buf,&nbsp;size,&nbsp;out);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;1;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sorg-&gt;pmode&nbsp;=&nbsp;sorg-&gt;mode;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sorg-&gt;mode&nbsp;=&nbsp;MODE_NONE;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print_ulist_end(sorg,&nbsp;out);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;parse(sorg,&nbsp;out,&nbsp;buf,&nbsp;size);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;1;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
}<br>
fwrite(buf&nbsp;+&nbsp;sorg-&gt;off,&nbsp;1,&nbsp;sorg-&gt;blksize,&nbsp;out);<br>
sorg-&gt;pmode&nbsp;=&nbsp;sorg-&gt;mode;<br>
if(sorg-&gt;mode&nbsp;!=&nbsp;MODE_CODE)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;sorg-&gt;mode&nbsp;=&nbsp;MODE_NONE;<br>
}<br>

</code></p>
<p>sorg.org:210
</p>
<a id="_parsing_top_4">
<div><b><i>&lt;&lt;parsing_top_4</b></i>&gt;&gt;=</div>
</a>
<p><code>&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;1;<br>
}<br>

</code></p>
<a id="getline">
<h3>1.7 getline</h3>
</a>
<p>sorg.org:1447
</p>
<a id="_getline_0">
<div><b><i>&lt;&lt;getline_0</b></i>&gt;&gt;=</div>
</a>
<p><code>size_t&nbsp;sorg_getline(char&nbsp;**lineptr,&nbsp;size_t&nbsp;*n,&nbsp;FILE&nbsp;*stream)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;char&nbsp;*bufptr&nbsp;=&nbsp;NULL;<br>
&nbsp;&nbsp;&nbsp;&nbsp;char&nbsp;*p&nbsp;=&nbsp;bufptr;<br>
&nbsp;&nbsp;&nbsp;&nbsp;size_t&nbsp;size;<br>
&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;c;<br>
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(lineptr&nbsp;==&nbsp;NULL)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;-1;<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(stream&nbsp;==&nbsp;NULL)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;-1;<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(n&nbsp;==&nbsp;NULL)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;-1;<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;bufptr&nbsp;=&nbsp;*lineptr;<br>
&nbsp;&nbsp;&nbsp;&nbsp;size&nbsp;=&nbsp;*n;<br>
&nbsp;&nbsp;&nbsp;&nbsp;c&nbsp;=&nbsp;fgetc(stream);<br>
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(c&nbsp;==&nbsp;EOF)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;-1;<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(bufptr&nbsp;==&nbsp;NULL)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bufptr&nbsp;=&nbsp;malloc(128);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(bufptr&nbsp;==&nbsp;NULL)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;-1;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;size&nbsp;=&nbsp;128;<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;p&nbsp;=&nbsp;bufptr;<br>
&nbsp;&nbsp;&nbsp;&nbsp;while(c&nbsp;!=&nbsp;EOF)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((p&nbsp;-&nbsp;bufptr)&nbsp;&gt;&nbsp;(size&nbsp;-&nbsp;1))&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;size&nbsp;=&nbsp;size&nbsp;+&nbsp;128;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bufptr&nbsp;=&nbsp;realloc(bufptr,&nbsp;size);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(bufptr&nbsp;==&nbsp;NULL)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;-1;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*p++&nbsp;=&nbsp;c;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(c&nbsp;==&nbsp;'\n')&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c&nbsp;=&nbsp;fgetc(stream);<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;*lineptr&nbsp;=&nbsp;bufptr;<br>
&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;Some&nbsp;text&nbsp;editors&nbsp;do&nbsp;not&nbsp;insert&nbsp;a&nbsp;linebreak&nbsp;on&nbsp;the&nbsp;last&nbsp;line.<br>
&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;For&nbsp;these&nbsp;cases,&nbsp;shift&nbsp;everything&nbsp;by&nbsp;1.<br>
&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
&nbsp;&nbsp;&nbsp;&nbsp;if(c&nbsp;==&nbsp;EOF)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p&nbsp;=&nbsp;p&nbsp;+&nbsp;1;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;size&nbsp;+=&nbsp;1;<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;*p++&nbsp;=&nbsp;'\0';<br>
&nbsp;&nbsp;&nbsp;&nbsp;*n&nbsp;=&nbsp;size;<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;p&nbsp;-&nbsp;bufptr&nbsp;-&nbsp;1;<br>
}<br>

</code></p>
<p>sorg.org:27
</p>
<a id="_main_loop_14">
<div><b><i>&lt;&lt;main_loop_14</b></i>&gt;&gt;=</div>
</a>
<p><code>int&nbsp;main(int&nbsp;argc,&nbsp;char&nbsp;*argv[])<br>
{<br>
&nbsp;&nbsp;&nbsp;&nbsp;FILE&nbsp;*in;<br>
&nbsp;&nbsp;&nbsp;&nbsp;FILE&nbsp;*out;<br>
&nbsp;&nbsp;&nbsp;&nbsp;char&nbsp;*line;<br>
&nbsp;&nbsp;&nbsp;&nbsp;size_t&nbsp;read;<br>
&nbsp;&nbsp;&nbsp;&nbsp;size_t&nbsp;n;<br>
&nbsp;&nbsp;&nbsp;&nbsp;sorg_d&nbsp;sorg;<br>
&nbsp;&nbsp;&nbsp;&nbsp;char&nbsp;*filename;<br>

</code></p>
<a id="local_variables">
<h3>1.8 local_variables</h3>
</a>
<p>sorg.org:1375
</p>
<a id="_local_variables_0">
<div><b><i>&lt;&lt;local_variables_0</b></i>&gt;&gt;=</div>
</a>
<p><code>struct&nbsp;parg_state&nbsp;ps;<br>
int&nbsp;c;<br>

</code></p>
<p>sorg.org:38
</p>
<a id="_main_loop_16">
<div><b><i>&lt;&lt;main_loop_16</b></i>&gt;&gt;=</div>
</a>
<p><code>&nbsp;&nbsp;&nbsp;&nbsp;filename&nbsp;=&nbsp;NULL;<br>
&nbsp;&nbsp;&nbsp;&nbsp;in&nbsp;=&nbsp;stdin;<br>

</code></p>
<a id="parse_command_flags">
<h3>1.9 parse_command_flags</h3>
</a>
<p>sorg.org:1381
</p>
<a id="_parse_command_flags_0">
<div><b><i>&lt;&lt;parse_command_flags_0</b></i>&gt;&gt;=</div>
</a>
<p><code>parg_init(&ps);<br>
while((c&nbsp;=&nbsp;parg_getopt(&ps,&nbsp;argc,&nbsp;argv,&nbsp;"st:"))&nbsp;!=&nbsp;-1)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;switch(c)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;1:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;filename&nbsp;=&nbsp;(char&nbsp;*)ps.optarg;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;'t':<br>

</code></p>
<a id="generate_toc">
<h4>1.9.1 generate_toc</h4>
</a>
<p>sorg.org:1424
</p>
<a id="_generate_toc_0">
<div><b><i>&lt;&lt;generate_toc_0</b></i>&gt;&gt;=</div>
</a>
<p><code>mktoc&nbsp;=&nbsp;1;<br>
indxfile&nbsp;=&nbsp;(char&nbsp;*)ps.optarg;<br>

</code></p>
<p>sorg.org:1389
</p>
<a id="_parse_command_flags_2">
<div><b><i>&lt;&lt;parse_command_flags_2</b></i>&gt;&gt;=</div>
</a>
<p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;'s':<br>

</code></p>
<a id="turn_on_sections">
<h4>1.9.2 turn_on_sections</h4>
</a>
<p>sorg.org:1406
</p>
<a id="_turn_on_sections_0">
<div><b><i>&lt;&lt;turn_on_sections_0</b></i>&gt;&gt;=</div>
</a>
<p><code>use_secno&nbsp;=&nbsp;1;<br>

</code></p>
<p>sorg.org:1392
</p>
<a id="_parse_command_flags_4">
<div><b><i>&lt;&lt;parse_command_flags_4</b></i>&gt;&gt;=</div>
</a>
<p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;default:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fprintf(stderr,&nbsp;"Unknown&nbsp;option&nbsp;-%c\n",&nbsp;c);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;1;<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
}<br>

</code></p>
<p>sorg.org:43
</p>
<a id="_main_loop_18">
<div><b><i>&lt;&lt;main_loop_18</b></i>&gt;&gt;=</div>
</a>
<p><code>&nbsp;&nbsp;&nbsp;&nbsp;if(filename&nbsp;!=&nbsp;NULL)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;in&nbsp;=&nbsp;fopen(filename,&nbsp;"r");<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;out&nbsp;=&nbsp;stdout;<br>
&nbsp;&nbsp;&nbsp;&nbsp;line&nbsp;=&nbsp;NULL;<br>
&nbsp;&nbsp;&nbsp;&nbsp;n&nbsp;=&nbsp;0;<br>
&nbsp;&nbsp;&nbsp;&nbsp;sorg_init(&sorg);<br>
&nbsp;&nbsp;&nbsp;&nbsp;while((read&nbsp;=&nbsp;sorg_getline(&line,&nbsp;&n,&nbsp;in))&nbsp;!=&nbsp;-1)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;parse(&sorg,&nbsp;out,&nbsp;line,&nbsp;read);<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;if(sorg.pmode&nbsp;==&nbsp;MODE_TEXT)&nbsp;fprintf(out,&nbsp;"&lt;/p&gt;");<br>
&nbsp;&nbsp;&nbsp;&nbsp;if(mktoc&nbsp;&&&nbsp;sorg.depth&nbsp;&gt;=&nbsp;0)&nbsp;fprintf(out,&nbsp;"&lt;/ul&gt;");<br>
&nbsp;&nbsp;&nbsp;&nbsp;if(in&nbsp;!=&nbsp;stdin)&nbsp;fclose(in);<br>
&nbsp;&nbsp;&nbsp;&nbsp;if(line&nbsp;!=&nbsp;NULL)&nbsp;free(line);<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;0;<br>
}<br>

</code></p>
</div>
</body>
</html>
