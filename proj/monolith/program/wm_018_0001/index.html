<!DOCTYPE html>
<html lang="en">
<head>

<meta charset="utf-8">
<link rel="stylesheet" href="/css/style.css">

</head>
<body>
<div id="main">
<title>Stretcher</title>
<h1>Stretcher</h1>
<p>A modified version of the paulstretch utility found in
Soundpipe. It is configured to work as a subprogram.
<div><b><i>&lt;&lt;stretcher.c&gt;&gt;=</i></b></div><pre><code>#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;
/* #include &lt;sndfile.h&gt; */
#include "soundpipe.h"

#if 0
/* Bring this back when sp_process is revamped */
static void process(sp_data *sp, void *ud)
{
    SPFLOAT out;
    sp_paulstretch *ps;
    ps = ud;
    sp_paulstretch_compute(sp, ps, NULL, &out);
    sp_out(sp, 0, out);
}
#endif

/* TODO: use drwav instead of libsndfile */
/* a little kluge to get file info */
static int get_info(const char *fname,
                    int *sr,
                    unsigned long *len)
{
    return 0;
    /* SF_INFO info; */
    /* SNDFILE *snd; */

    /* snd = sf_open(fname, SFM_READ, &info); */
    /* if (snd == NULL) return 0; */

    /* *sr = info.samplerate; */
    /* *len = info.frames; */
    /* sf_close(snd); */
    /* return 1; */
}

int stretcher_main(int argc, char *argv[])
{
    sp_data *sp;
    sp_ftbl *ft;
    sp_paulstretch *ps;

    SPFLOAT stretch;
    SPFLOAT window;
    const char *fin;
    const char *fout;
    int rc;

    fprintf(stderr,
            "stretcher is BROKEN until sp_process can be fixed\n");
    return 1;

    if(argc &lt; 5) {
        fprintf(stderr,
            "Usage: %s window_size stretch in.wav out.wav\n",
            argv[0]
        );
        return 1;
    }

    sp_create(&sp);

    printf("samplerate = %d\n", atoi(argv[1]));

    sp_paulstretch_create(&ps);

    fin = argv[3];
    fout = argv[4];
    rc = get_info(fin, &sp-&gt;sr, &sp-&gt;len);

    if (!rc) {
        printf("There was a problem with the file '%s'\n",
               fin);
        goto cleanup;
    }

    printf("window = %g\n", atof(argv[1]));
    window = atof(argv[1]);
    printf("stretch = %g\n", atof(argv[2]));
    stretch = atof(argv[2]);
    sp-&gt;len *= stretch;
    printf("total dur = %gs\n", (SPFLOAT)sp-&gt;len / sp-&gt;sr);
    printf("input = %s\n", fin);
    sp_ftbl_loadfile(sp, &ft, fin);
    printf("output = %s\n", fout);

    strncpy(sp-&gt;filename, fout, 60);

    sp_paulstretch_init(sp, ps, ft, window, stretch);

    ps-&gt;wrap = 0;

    /* TODO: bring back */
    /* sp_process(sp, ps, process); */

    cleanup:

    sp_ftbl_destroy(&ft);
    sp_paulstretch_destroy(&ps);
    sp_destroy(&sp);
    return 0;
}</pre></code>
</div>
</body>
</html>
