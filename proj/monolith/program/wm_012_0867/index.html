<!DOCTYPE html>
<html lang="en">
<head>

<meta charset="utf-8">
<link rel="stylesheet" href="/css/style.css">

</head>
<body>
<div id="main">

<h3>10. Line16 Runt Words</h3>

<p><a id="wm_012_0867"></a></p>

<h4>10.1. Runt Loader</h4>

<p><a id="wm_012_0868"></a>All runt words are loaded with the function
<code>line16_runt_loader</code>. It is loaded at init time.
<div><b><i>&lt;&lt;line16_function_declarations&gt;&gt;=</i></b></div><pre><code>static int line16_runt_loader(monolith_d *m);</pre></code>
<div><b><i>&lt;&lt;line16_functions&gt;&gt;=</i></b></div><pre><code>&lt;&lt;line16_runt_functions&gt;&gt;
static int line16_runt_loader(monolith_d *m)
{
&lt;&lt;line16_runt_keywords&gt;&gt;
    monolith_runt_mark_set(m);
    return RUNT_OK;
}</pre></code>
<div><b><i>&lt;&lt;line16_runtime_init&gt;&gt;=</i></b></div><pre><code>line16_runt_loader(m);</pre></code>

<h4>10.2. line16</h4>

<p><a id="wm_012_0880"></a>Call this once inside a patchwerk patch. Computes the line.
<div><b><i>&lt;&lt;line16_runt_keywords&gt;&gt;=</i></b></div><pre><code>monolith_runt_keyword(m,
                      "line16", 6,
                      rproc_line16,
                      m);</pre></code>
<div><b><i>&lt;&lt;line16_runt_functions&gt;&gt;=</i></b></div><pre><code>static runt_int rproc_line16(runt_vm *vm, runt_ptr p)
{
    monolith_d *m;
    runt_int rc;
    rpw_param in;
    pw_patch *patch;
    pw_node *node;
    const char *name;
    runt_stacklet *s;
    /* runt_stacklet *out; */
    monolith_page *pg;
    page_line16_d *line16;

    m = runt_to_cptr(p);
    rc = runt_ppop(vm, &s);
    RUNT_ERROR_CHECK(rc);

    name = runt_to_string(s-&gt;p);

    rc = rpw_get_param(vm, &in);
    RUNT_ERROR_CHECK(rc);

    rc = runt_monolith_lookup_page(vm, m,
                                   name,
                                   "line16",
                                   is_line16,
                                   &pg);
    RUNT_ERROR_CHECK(rc);

    line16 = monolith_page_data_get(pg);

    patch = monolith_patchwerk_get(m);
    rc = pw_patch_new_node(patch, &node);
    PW_RUNT_ERROR_CHECK(rc);
    node_line16(node, line16);

    rpw_set_param(vm, node, &in, 0);
    return RUNT_OK;
}</pre></code>

<h4>10.3. line16line</h4>

<p><a id="wm_012_0888"></a>Retrives the line.
<div><b><i>&lt;&lt;line16_runt_keywords&gt;&gt;=</i></b></div><pre><code>monolith_runt_keyword(m,
                      "line16line", 10,
                      rproc_line16line,
                      m);</pre></code>
<div><b><i>&lt;&lt;line16_runt_functions&gt;&gt;=</i></b></div><pre><code>static runt_int rproc_line16line(runt_vm *vm, runt_ptr p)
{
    monolith_d *m;
    runt_int rc;
    pw_patch *patch;
    pw_node *node;
    const char *name;
    runt_stacklet *s;
    runt_stacklet *out;
    monolith_page *pg;
    page_line16_d *line16;

    m = runt_to_cptr(p);
    rc = runt_ppop(vm, &s);
    RUNT_ERROR_CHECK(rc);

    name = runt_to_string(s-&gt;p);

    rc = runt_monolith_lookup_page(vm, m,
                                   name,
                                   "line16",
                                   is_line16,
                                   &pg);
    RUNT_ERROR_CHECK(rc);

    rc = runt_ppush(vm, &out);
    RUNT_ERROR_CHECK(rc);

    line16 = monolith_page_data_get(pg);

    patch = monolith_patchwerk_get(m);
    rc = pw_patch_new_node(patch, &node);
    PW_RUNT_ERROR_CHECK(rc);
    node_line(node, line16);

    rpw_push_output(vm, node, out, 0);
    return RUNT_OK;
}</pre></code>

<h4>10.4. line16gpr</h4>

<p><a id="wm_012_0894"></a>Retrives the line.
<div><b><i>&lt;&lt;line16_runt_keywords&gt;&gt;=</i></b></div><pre><code>monolith_runt_keyword(m,
                      "line16gpr", 9,
                      rproc_line16gpr,
                      m);</pre></code>
<div><b><i>&lt;&lt;line16_runt_functions&gt;&gt;=</i></b></div><pre><code>static runt_int rproc_line16gpr(runt_vm *vm, runt_ptr p)
{
    monolith_d *m;
    runt_int rc;
    rpw_param in;
    pw_patch *patch;
    pw_node *node;
    const char *name;
    runt_stacklet *s;
    monolith_page *pg;
    page_line16_d *line16;

    m = runt_to_cptr(p);
    rc = runt_ppop(vm, &s);
    RUNT_ERROR_CHECK(rc);

    name = runt_to_string(s-&gt;p);


    rc = rpw_get_param(vm, &in);
    RUNT_ERROR_CHECK(rc);

    rc = runt_monolith_lookup_page(vm, m,
                                   name,
                                   "line16",
                                   is_line16,
                                   &pg);
    RUNT_ERROR_CHECK(rc);

    line16 = monolith_page_data_get(pg);

    patch = monolith_patchwerk_get(m);
    rc = pw_patch_new_node(patch, &node);
    PW_RUNT_ERROR_CHECK(rc);
    node_gpr(node, line16);

    rpw_set_param(vm, node, &in, 0);
    return RUNT_OK;
}</pre></code>

<h4>10.5. line16lpr</h4>

<p><a id="wm_012_0900"></a>Retrives the line.
<div><b><i>&lt;&lt;line16_runt_keywords&gt;&gt;=</i></b></div><pre><code>monolith_runt_keyword(m,
                      "line16lpr", 9,
                      rproc_line16lpr,
                      m);</pre></code>
<div><b><i>&lt;&lt;line16_runt_functions&gt;&gt;=</i></b></div><pre><code>static runt_int rproc_line16lpr(runt_vm *vm, runt_ptr p)
{
    monolith_d *m;
    runt_int rc;
    rpw_param in;
    rpw_param line;
    rpw_param pos;
    pw_patch *patch;
    pw_node *node;
    const char *name;
    runt_stacklet *s;
    monolith_page *pg;
    page_line16_d *line16;

    m = runt_to_cptr(p);
    rc = runt_ppop(vm, &s);
    RUNT_ERROR_CHECK(rc);

    name = runt_to_string(s-&gt;p);

    rc = rpw_get_param(vm, &pos);
    RUNT_ERROR_CHECK(rc);

    rc = rpw_get_param(vm, &line);
    RUNT_ERROR_CHECK(rc);

    rc = rpw_get_param(vm, &in);
    RUNT_ERROR_CHECK(rc);

    rc = runt_monolith_lookup_page(vm, m,
                                   name,
                                   "line16",
                                   is_line16,
                                   &pg);
    RUNT_ERROR_CHECK(rc);

    line16 = monolith_page_data_get(pg);

    patch = monolith_patchwerk_get(m);
    rc = pw_patch_new_node(patch, &node);
    PW_RUNT_ERROR_CHECK(rc);
    node_lpr(node, line16);


    rpw_set_param(vm, node, &in, 0);
    rpw_set_param(vm, node, &line, 1);
    rpw_set_param(vm, node, &pos, 2);
    return RUNT_OK;
}</pre></code>

<h4>10.6. line16aux</h4>

<p><a id="wm_012_0906"></a>Retrives the line.
<div><b><i>&lt;&lt;line16_runt_keywords&gt;&gt;=</i></b></div><pre><code>monolith_runt_keyword(m,
                      "line16aux", 9,
                      rproc_line16aux,
                      m);</pre></code>
<div><b><i>&lt;&lt;line16_runt_functions&gt;&gt;=</i></b></div><pre><code>static runt_int rproc_line16aux(runt_vm *vm, runt_ptr p)
{
    monolith_d *m;
    runt_int rc;
    rpw_param in;
    rpw_param aux;
    rpw_param line;
    rpw_param pos;
    pw_patch *patch;
    pw_node *node;
    const char *name;
    runt_stacklet *s;
    monolith_page *pg;
    page_line16_d *line16;

    m = runt_to_cptr(p);
    rc = runt_ppop(vm, &s);
    RUNT_ERROR_CHECK(rc);

    name = runt_to_string(s-&gt;p);

    rc = rpw_get_param(vm, &pos);
    RUNT_ERROR_CHECK(rc);

    rc = rpw_get_param(vm, &line);
    RUNT_ERROR_CHECK(rc);

    rc = rpw_get_param(vm, &aux);
    RUNT_ERROR_CHECK(rc);

    rc = rpw_get_param(vm, &in);
    RUNT_ERROR_CHECK(rc);

    rc = runt_monolith_lookup_page(vm, m,
                                   name,
                                   "line16",
                                   is_line16,
                                   &pg);
    RUNT_ERROR_CHECK(rc);

    line16 = monolith_page_data_get(pg);

    patch = monolith_patchwerk_get(m);
    rc = pw_patch_new_node(patch, &node);
    PW_RUNT_ERROR_CHECK(rc);
    node_aux(node, line16);


    rpw_set_param(vm, node, &in, 0);
    rpw_set_param(vm, node, &aux, 1);
    rpw_set_param(vm, node, &line, 2);
    rpw_set_param(vm, node, &pos, 3);
    return RUNT_OK;
}</pre></code>

<h4>10.7. line16lline</h4>

<p><a id="wm_012_0912"></a>Makes a local line.
<div><b><i>&lt;&lt;line16_runt_keywords&gt;&gt;=</i></b></div><pre><code>monolith_runt_keyword(m,
                      "line16lline", 11,
                      rproc_line16lline,
                      m);</pre></code>
<div><b><i>&lt;&lt;line16_runt_functions&gt;&gt;=</i></b></div><pre><code>static runt_int rproc_line16lline(runt_vm *vm, runt_ptr p)
{
    monolith_d *m;
    runt_int rc;
    pw_patch *patch;
    pw_node *node;
    const char *name;
    runt_stacklet *s;
    runt_stacklet *out;
    monolith_page *pg;
    page_line16_d *line16;
    rpw_param in;
    int linepos;
    line16_line *line;


    m = runt_to_cptr(p);

    rc = runt_ppop(vm, &s);
    RUNT_ERROR_CHECK(rc);
    name = runt_to_string(s-&gt;p);

    rc = runt_monolith_lookup_page(vm, m,
                                   name,
                                   "line16",
                                   is_line16,
                                   &pg);
    RUNT_ERROR_CHECK(rc);

    rc = runt_ppop(vm, &s);
    RUNT_ERROR_CHECK(rc);
    linepos = s-&gt;f;

    rc = rpw_get_param(vm, &in);
    RUNT_ERROR_CHECK(rc);


    if (linepos &lt; 0 || linepos &gt;= 16) {
        runt_print(vm,
                   "line position out of range: %d\n",
                   linepos);
    }

    rc = runt_ppush(vm, &out);
    RUNT_ERROR_CHECK(rc);

    line16 = monolith_page_data_get(pg);

    line = &line16-&gt;lines[linepos];

    patch = monolith_patchwerk_get(m);
    rc = pw_patch_new_node(patch, &node);
    PW_RUNT_ERROR_CHECK(rc);
    node_lline(node, line16, line);

    rpw_set_param(vm, node, &in, 0);
    rpw_push_output(vm, node, out, 1);
    return RUNT_OK;
}</pre></code>
<p></p>
<br>
<p><hr>

<a href="/proj/monolith/program/wm_012_0002">prev</a> | <a href="/proj/monolith/program/wm_012">home</a> | <a href="/proj/monolith/program/wm_012_0918">next</a></p>
</div>
</body>
</html>
