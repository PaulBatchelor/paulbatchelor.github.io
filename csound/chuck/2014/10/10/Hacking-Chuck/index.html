<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
	<meta http-equiv='Content-Type' content='text/html; charset=utf-8' />
	<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1' />
    <title>Paul Batchelor : Hacking Chuck: The Csound UGen</title>
    <meta name="viewport" content="width=device-width">
    <meta name="description" content="This is the homepage of Paul Batchelor">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="/u/4886742/css/main.css">
	<link rel="stylesheet" href="/u/4886742/css/menu.css">

</head>


    <body>

    <header class="site-header">
<div id='cssmenu'>
<ul>
   <li><a href="/u/4886742/">
   <span>Home</span></a></li>
   <li><a href="/u/4886742/about">
   <span>About</span></a></li>
   <li><a href="/u/4886742/portfolio">
   <span>Portfolio</span></a></li>
   <li><a href="/u/4886742/blog">
   <span>Blog</span></a></li>
   <li><a href="/u/4886742/contact">
   <span>Contact</span></a></li>
</ul>
</div>
</header>


    <div class="page-content">
      <div class="wrap">
        <header class="post-header">
    <h1>Hacking Chuck: The Csound UGen</h1>
    <p class="meta">Oct 10, 2014</p>
  </header>

  <article class="post-content">
  <p>I’m very proud to introduce my latest hack to the world: plopping Csound inside of ChucK. </p>

<p>This idea spawned from a problem I was having with ChucK: I was enjoying the language, but I wasn’t enjoying the sounds it was creating. The built in Unit Generators (called Ugens) left more to be desired. Luckily, there was documentation on how to build your own UGens, so I used that to bring Csound’s beautiful reverbsc opcode into ChucK. This reverb in ChucK suddenly made the language sound infinitely better. I then wanted to see how hard it would be bring the Csound API into ChucK as a UGen. That way, I could use the sound of Csound with the level of control in ChucK. </p>

<p>The Csound and ReverbSC UGens are the start of what I like to call the Blackbox Plugins for ChucK. The github for the Blackbox plugins can be found <a href="https://github.com/PaulBatchelor/blackbox">here</a>. </p>

<h2 id="setting-up">Setting up</h2>

<p>Blackbox is designed to be compiled with the main ChucK codebase. In order to do this, you must download the latest ChucK source code, clone the Blackbox repo in the src/ directory, and then use the patch provided in the repo on the ChucK codebase. After downloading the ChucK source, you can do all this from the command line:</p>

<div class="highlight"><pre><code class="bash">tar zxvf chuck-1.3.4.0.tgz
<span class="nb">cd </span>chuck-1.3.4.0/src
git clone https://github.com/PaulBatchelor/blackbox
patch -p2 blackbox/blackbox.patch</code></pre></div>

<p>Csound6 must be installed before compiling ChucK. After Csound6 is installed, ChucK can then be compiled using “make”. Running make without any arguments will list all the available platforms. Choose the one that is for you. At the moment, the blackbox plugins have only been tested on Linux machines. </p>

<h2 id="examples">Examples</h2>

<p>The Csound UGen is created like any other UGen, but behaves a little bit differently. You must compile a valid CSD file for it to work. In this example, ChucK is sending note events to Csound. </p>

<div class="highlight"><pre><code class="c--"><span class="n">Csound</span> <span class="n">c</span> <span class="o">=&gt;</span> <span class="n">dac</span><span class="p">;</span>

<span class="n">c</span><span class="p">.</span><span class="n">compile</span><span class="p">(</span><span class="s">&quot;pluck.csd&quot;</span><span class="p">);</span>

<span class="n">string</span> <span class="n">message</span><span class="p">;</span>
<span class="kt">float</span> <span class="n">freq</span><span class="p">;</span>

<span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="s">&quot;i1 0 3 &quot;</span> <span class="o">=&gt;</span> <span class="n">message</span><span class="p">;</span>
    <span class="n">Std</span><span class="p">.</span><span class="n">rand2</span><span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mi">800</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">freq</span><span class="p">;</span>
    <span class="n">freq</span> <span class="o">+=&gt;</span> <span class="n">message</span><span class="p">;</span>
    <span class="n">c</span><span class="p">.</span><span class="n">inputMessage</span><span class="p">(</span><span class="n">message</span><span class="p">);</span>
    <span class="mf">0.5</span><span class="o">::</span><span class="n">second</span> <span class="o">=&gt;</span> <span class="n">now</span><span class="p">;</span>
<span class="p">}</span></code></pre></div>

<p>The corresponding “pluck.csd” can be found below. In order for Csound to work properly inside of ChucK, nchnls and ksmps must be 1:</p>

<div class="highlight"><pre><code class="xml"><span class="nt">&lt;CsoundSynthesizer&gt;</span>
<span class="nt">&lt;CsOptions&gt;</span>
;disable audio output and let ChucK handle it all
-d -onull -+rtaudio=null 
<span class="nt">&lt;/CsOptions&gt;</span>
<span class="nt">&lt;CsInstruments&gt;</span>

sr	=	44100
ksmps	=	1
nchnls	=	1
0dbfs	=	1

instr 1	
aout = \
pluck(0.1, p4, p4, 0, 1) * linseg(1, p3, 0)
out aout
endin

<span class="nt">&lt;/CsInstruments&gt;</span>
<span class="nt">&lt;CsScore&gt;</span>
f 0 $INF
<span class="nt">&lt;/CsScore&gt;</span>
<span class="nt">&lt;/CsoundSynthesizer&gt;</span></code></pre></div>

<p>In addition to synthesizing audio, the Csound UGen can also process audio from ChucK. Chuck will automatically send audio to the channel called “Chuck_Out”, which can be retrieved in Csound.</p>

<p>In this example, note the use of the ReverbSC UGen. This was ported directly from ReverbSC source code in Csound. At the moment, this is the only opcode that has been ported as a ChucK UGen, but more will come.</p>

<div class="highlight"><pre><code class="c--"><span class="n">SawOsc</span> <span class="n">s</span> <span class="o">=&gt;</span> <span class="n">LPF</span> <span class="n">l</span> <span class="o">=&gt;</span> <span class="n">ReverbSC</span> <span class="n">r</span> <span class="o">=&gt;</span> <span class="n">Csound</span> <span class="n">c</span> <span class="o">=&gt;</span> <span class="n">dac</span><span class="p">;</span>

<span class="mf">0.93</span> <span class="o">=&gt;</span> <span class="n">r</span><span class="p">.</span><span class="n">size</span><span class="p">;</span>
<span class="n">c</span><span class="p">.</span><span class="n">compile</span><span class="p">(</span><span class="s">&quot;waveset.csd&quot;</span><span class="p">);</span>
<span class="n">l</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">);</span>

<span class="n">string</span> <span class="n">message</span><span class="p">;</span>
<span class="kt">float</span> <span class="n">freq</span><span class="p">;</span>

<span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">Std</span><span class="p">.</span><span class="n">rand2</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">s</span><span class="p">.</span><span class="n">freq</span><span class="p">;</span>
    <span class="mi">500</span><span class="o">::</span><span class="n">ms</span> <span class="o">=&gt;</span> <span class="n">now</span><span class="p">;</span>
<span class="p">}</span></code></pre></div>

<p>The corresponding CSD shows Csound taking the input from ChucK and sending it through the waveset opcode.</p>

<div class="highlight"><pre><code class="xml"><span class="nt">&lt;CsoundSynthesizer&gt;</span>
<span class="nt">&lt;CsOptions&gt;</span>
-d -onull -+rtaudio=null 
-b 1
<span class="nt">&lt;/CsOptions&gt;</span>
<span class="nt">&lt;CsInstruments&gt;</span>

sr	=	44100
ksmps	=	1
nchnls	=	1
0dbfs	=	1

alwayson 2
instr 2
a1 chnget &quot;Chuck_Out&quot;
out waveset(a1, 5) * 0.5
endin

<span class="nt">&lt;/CsInstruments&gt;</span>
<span class="nt">&lt;CsScore&gt;</span>
f 0 $INF
<span class="nt">&lt;/CsScore&gt;</span>
<span class="nt">&lt;/CsoundSynthesizer&gt;</span></code></pre></div>

<p>All of the examples here can be found in the <em>examples</em> folder in the blackbox github repository. </p>

<h2 id="things-left-to-do">Things Left To Do…</h2>

<p>There is a lot more I want done with the Blackbox plugins and the Csound Ugen, but I’m pretty satisfied with this being a “first start”</p>

<p>Here’s a little list of features that I hope to implement someday:
* i-rate, k-rate, a-rate I/O</p>

<ul>
  <li>
    <p>Port more Csound Opcodes to BlackBox</p>
  </li>
  <li>
    <p>Csound compilation from string instead of external file</p>
  </li>
  <li>
    <p>Recompilation/evaluation of Csound code inside of ChucK</p>
  </li>
  <li>
    <p>Live coding with Csound… possibly creating a Csound as a global library instead of UGen</p>
  </li>
</ul>


  </article>

      </div>
    </div>

    <div class = "site-footer">

    Copyright 2014 Paul Batchelor

</div>


    </body>
</html>
