<!DOCTYPE html>
<html lang="en">
<head>

<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="/gestlings/css/style.css">

</head>
<body>
<div id="main">
<p><title>The Gesture Path</title>
<h1>The Gesture Path</h1>
</p>

<h2>1. <a id="overview">Overview</a></h2>

<p>This document implements a Lua interface for create Gesture
Paths for Gesture VM. Paths constructed in Lua eventually
get generated into <a href="/gestlings/tal">tal</a> code.
</p>

<h2>2. <a id="whats-a-path">What's a "Path"?</a></h2>

<p>A <b>path</b> is a construct used to describe Gestures. This
is a term borrowed from computer science and graph
theory. A path
can be described as a sequential set of vertices,
connected together by edges. In this context,
a vertice can be thought of as a set of state parameters
for the Gesture Signal Generator: value, behavior, and
rate multiplier. Alternatively, one could also imagine
edges as being weighted by the rate multiplier, but at
the time of writing there hasn't been any usecase for
doing it this way.
</p>
<p>A path is said to be <b>linear</b> if the vertices flow in
one single direction. A path becomes <b>non-linear</b> when this
flow is interrupted somehow, such as with branching.
</p>

<h2>3. <a id="tangled-code">Tangled Code</a></h2>

<div><b><i>&lt;&lt;path.lua&gt;&gt;=</i></b></div><pre><code>local Path = {}

&lt;&lt;path&gt;&gt;
return Path</pre></code>

<h2>4. <a id="creating-a-vertex">Creating a Vertex</a></h2>

<p>The <code>vertex</code> function creates a gesture vertex, represented
as a lua table. The input is an array of 3 values: value,
duration, and behavior.
</p>
<p>Duration is itself a 2-element array containing the numerator
and denominator values for the rate multiplier.
</p>
<p>Behavior is an integer value indicating the type of behavior
to be used. See the <a href="/gestlings/gest#behavior_constants">gest behavior constants</a> for some human-friendly variable
names to use instead of just numbers.
</p>
<div><b><i>&lt;&lt;path&gt;&gt;=</i></b></div><pre><code>function Path.vertex(v)
    x = {}

    x.val = v[1]
    x.dur = v[2]
    x.bhvr = v[3]

    return x
end</pre></code>

<h2>5. <a id="compiling-a-path">Compiling a Path</a></h2>

<p>A Path, represented as an array of Gesture vertices in
Lua, can be compiled into TAL code using the <code>path</code>function. In addition to the path to be compiled,
the <a href="/gestlings/tal">tal</a> library will need to be passed in,
along with a table to place the words that get generated.
</p>
<div><b><i>&lt;&lt;path&gt;&gt;=</i></b></div><pre><code>function Path.path(tal, words, path)
    for _, v in pairs(path)
    do
        if v.val ~= nil then
            tal.val(words, v.val)
        end

        if v.dur ~= nil then
            tal.dur(words, v.dur[1], v.dur[2])
        end

        if v.bhvr ~= nil then
            tal.behavior(words, v.bhvr)
        end
    end
end
</pre></code>

<h2>6. <a id="savingloading-paths-as-assets">Saving/Loading Paths as Assets</a></h2>

<p>Requires an instantiated <a href="/gestlings/asset">asset</a> component.
</p>
<div><b><i>&lt;&lt;path&gt;&gt;=</i></b></div><pre><code>function Path.save(asset, gpath, filename)
    asset:save(gpath, filename)
end

function Path.load(asset, filename)
    local path_data = asset:load(filename)

    return Path.data_to_path(path_data)
end</pre></code>
<p></p>
<p>Path data saved to disk is a simpler format than the
format used by Path. The function <code>data_to_path</code> does the
conversion.
</p>
<div><b><i>&lt;&lt;path&gt;&gt;=</i></b></div><pre><code>function Path.data_to_path(path_data)
    local gpath = {}
    for _,v in pairs(path_data) do
        table.insert(gpath, Path.vertex(v))
    end
    return gpath
end

function Path.path_to_data(path)
    local path_data = {}
    for _,v in pairs(path) do
        table.insert(path_data, {
            v.val,
            v.dur,
            v.bhvr,
        })
    end

    return path_data
end</pre></code>

<h2>7. <a id="symbol-set-and-grammar">Symbol Set and Grammar</a></h2>

<p>For the symbol set, see <a href="/gestlings/path_symbols">path_symbols</a>.
The corresponding grammar can be found
at <a href="/gestlings/path_grammar">path_grammar</a>.
</p>

<h2>8. <a id="ast-to-path">AST to Path</a></h2>

<p>Converts an abstract syntax tree generated from the <a href="/gestlings/path_grammar">path_grammar</a> into an actual path.
<div><b><i>&lt;&lt;path&gt;&gt;=</i></b></div><pre><code>function Path.AST_to_data(t)
    behaviors = {
        linear = 0,
        step = 1,
        gliss_medium = 2,
        gliss_large = 3,
        gliss_small = 4,
    }

    local ratemul = {1, 1}
    local behavior = behaviors["linear"]
    local gpath = {}

    for _,v in pairs(t) do
        local val = tonumber("0x" .. v.value[1] .. v.value[2])
        if v.behavior ~= nil then
            behavior = behaviors[v.behavior]
        end

        if v.ratemul ~= nil then
            if #v.ratemul == 2 then
                local num, den
                num = v.ratemul[1]
                num = tonumber("0x" .. num[1] .. num[2])
                den = v.ratemul[2]
                den = tonumber("0x" .. den[1] .. den[2])
                ratemul = {num, den}
            elseif #v.ratemul == 1 then
                local num, den
                num = v.ratemul[1]
                num = tonumber("0x" .. num[1] .. num[2])
                ratemul = {num}
            end
        end
        local vertex = {
            val,
            ratemul,
            behavior
        }
        table.insert(gpath, vertex)
    end
    return gpath
end</pre></code>
</p>
</div>
</body>
</html>
