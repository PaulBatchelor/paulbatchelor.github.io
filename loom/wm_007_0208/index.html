<!DOCTYPE html>
<html lang="en">
<head>

<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="/css/style.css">

</head>
<body>
<div id="main">

<h2>5. Main Interface</h2>

<p><a id="wm_007_0208"></a>Orgparse is a callback interface. These functions will
handle the various parts of the org file.
</p>

<h3>5.1. Struct</h3>

<p><a id="wm_007_0210"></a></p>

<h4>5.1.1. Declaration</h4>

<p><a id="wm_007_0211"></a><div><b><i>&lt;&lt;typedefs&gt;&gt;=</i></b></div><pre><code>typedef struct orgparse orgparse;</pre></code>
<div><b><i>&lt;&lt;structs&gt;&gt;=</i></b></div><pre><code>struct orgparse {
&lt;&lt;interface&gt;&gt;
};</pre></code>

<h4>5.1.2. Init</h4>

<p><a id="wm_007_0220"></a><div><b><i>&lt;&lt;funcdefs&gt;&gt;=</i></b></div><pre><code>void orgparse_init(orgparse *op);</pre></code>
<div><b><i>&lt;&lt;functions&gt;&gt;=</i></b></div><pre><code>void orgparse_init(orgparse *op)
{
&lt;&lt;init&gt;&gt;
}</pre></code>

<h4>5.1.3. Size</h4>

<p><a id="wm_007_0228"></a>When using is opaquely.
<div><b><i>&lt;&lt;funcdefs&gt;&gt;=</i></b></div><pre><code>size_t orgparse_size(void);</pre></code>
<div><b><i>&lt;&lt;functions&gt;&gt;=</i></b></div><pre><code>size_t orgparse_size(void)
{
    return sizeof(orgparse);
}</pre></code>

<h3>5.2. Callbacks</h3>

<p><a id="wm_007_0234"></a>All callbacks have the same first 3 arguments: a generic
pointer, the string, and the length of the string.
</p>

<h4>5.2.1. Header</h4>

<p><a id="wm_007_0236"></a>An org header. In addition to the header name, also supplies
the header level.
<div><b><i>&lt;&lt;typedefs&gt;&gt;=</i></b></div><pre><code>typedef void (*orgparse_header)(void *,
                                const char *,
                                size_t,
                                int);</pre></code>
<div><b><i>&lt;&lt;interface&gt;&gt;=</i></b></div><pre><code>orgparse_header header;</pre></code>
<div><b><i>&lt;&lt;init&gt;&gt;=</i></b></div><pre><code>op-&gt;header = NULL;</pre></code>
<div><b><i>&lt;&lt;funcdefs&gt;&gt;=</i></b></div><pre><code>void orgparse_set_header(orgparse *op, orgparse_header f);</pre></code>
<div><b><i>&lt;&lt;functions&gt;&gt;=</i></b></div><pre><code>void orgparse_set_header(orgparse *op, orgparse_header f)
{
    op-&gt;header = f;
}</pre></code>

<h4>5.2.2. Text</h4>

<p><a id="wm_007_0250"></a>This function is anything that isn't formatted text.
<div><b><i>&lt;&lt;typedefs&gt;&gt;=</i></b></div><pre><code>typedef void (*orgparse_text)(void *,
                              const char *,
                              size_t);</pre></code>
<div><b><i>&lt;&lt;interface&gt;&gt;=</i></b></div><pre><code>orgparse_text text;</pre></code>
<div><b><i>&lt;&lt;init&gt;&gt;=</i></b></div><pre><code>op-&gt;text = NULL;</pre></code>
<div><b><i>&lt;&lt;funcdefs&gt;&gt;=</i></b></div><pre><code>void orgparse_set_text(orgparse *op, orgparse_text f);</pre></code>
<div><b><i>&lt;&lt;functions&gt;&gt;=</i></b></div><pre><code>void orgparse_set_text(orgparse *op, orgparse_text f)
{
    op-&gt;text = f;
}</pre></code>

<h4>5.2.3. Code</h4>

<p><a id="wm_007_0262"></a>Text that is defined inside the <code>codeblock</code> tags.
<div><b><i>&lt;&lt;interface&gt;&gt;=</i></b></div><pre><code>orgparse_text code;</pre></code>
<div><b><i>&lt;&lt;init&gt;&gt;=</i></b></div><pre><code>op-&gt;code = NULL;</pre></code>
<div><b><i>&lt;&lt;funcdefs&gt;&gt;=</i></b></div><pre><code>void orgparse_set_code(orgparse *op, orgparse_text f);</pre></code>
<div><b><i>&lt;&lt;functions&gt;&gt;=</i></b></div><pre><code>void orgparse_set_code(orgparse *op, orgparse_text f)
{
    op-&gt;code = f;
}</pre></code>

<h4>5.2.4. Bold</h4>

<p><a id="wm_007_0272"></a>Text that is defined inside the <b>bold</b> tags.
<div><b><i>&lt;&lt;interface&gt;&gt;=</i></b></div><pre><code>orgparse_text bold;</pre></code>
<div><b><i>&lt;&lt;init&gt;&gt;=</i></b></div><pre><code>op-&gt;bold = NULL;</pre></code>
<div><b><i>&lt;&lt;funcdefs&gt;&gt;=</i></b></div><pre><code>void orgparse_set_bold(orgparse *op, orgparse_text f);</pre></code>
<div><b><i>&lt;&lt;functions&gt;&gt;=</i></b></div><pre><code>void orgparse_set_bold(orgparse *op, orgparse_text f)
{
    op-&gt;bold = f;
}</pre></code>

<h4>5.2.5. Italic</h4>

<p><a id="wm_007_0282"></a>Text that is defined inside the <b></b>italic<b></b> tags.
<div><b><i>&lt;&lt;interface&gt;&gt;=</i></b></div><pre><code>orgparse_text italic;</pre></code>
<div><b><i>&lt;&lt;init&gt;&gt;=</i></b></div><pre><code>op-&gt;italic = NULL;</pre></code>
<div><b><i>&lt;&lt;funcdefs&gt;&gt;=</i></b></div><pre><code>void orgparse_set_italic(orgparse *op, orgparse_text f);</pre></code>
<div><b><i>&lt;&lt;functions&gt;&gt;=</i></b></div><pre><code>void orgparse_set_italic(orgparse *op, orgparse_text f)
{
    op-&gt;italic = f;
}</pre></code>

<h4>5.2.6. Underline</h4>

<p><a id="wm_007_0292"></a>Text that is contained inside the  tags.
<div><b><i>&lt;&lt;interface&gt;&gt;=</i></b></div><pre><code>orgparse_text underline;</pre></code>
<div><b><i>&lt;&lt;init&gt;&gt;=</i></b></div><pre><code>op-&gt;underline = NULL;</pre></code>
<div><b><i>&lt;&lt;funcdefs&gt;&gt;=</i></b></div><pre><code>void orgparse_set_underline(orgparse *op, orgparse_text f);</pre></code>
<div><b><i>&lt;&lt;functions&gt;&gt;=</i></b></div><pre><code>void orgparse_set_underline(orgparse *op, orgparse_text f)
{
    op-&gt;underline = f;
}</pre></code>

<h4>5.2.7. Code Block</h4>

<p><a id="wm_007_0302"></a>Text inside of a code block.
<div><b><i>&lt;&lt;interface&gt;&gt;=</i></b></div><pre><code>orgparse_text codeblock;</pre></code>
<div><b><i>&lt;&lt;init&gt;&gt;=</i></b></div><pre><code>op-&gt;codeblock = NULL;</pre></code>
<div><b><i>&lt;&lt;funcdefs&gt;&gt;=</i></b></div><pre><code>void orgparse_set_codeblock(orgparse *op, orgparse_text f);</pre></code>
<div><b><i>&lt;&lt;functions&gt;&gt;=</i></b></div><pre><code>void orgparse_set_codeblock(orgparse *op, orgparse_text f)
{
    op-&gt;codeblock = f;
}</pre></code>

<h4>5.2.8. Aux</h4>

<p><a id="wm_007_0312"></a>A special non-org tag, used for interpolated code in tags <code>@!</code>
and <code>!@</code>.
<div><b><i>&lt;&lt;interface&gt;&gt;=</i></b></div><pre><code>orgparse_text aux;</pre></code>
<div><b><i>&lt;&lt;init&gt;&gt;=</i></b></div><pre><code>op-&gt;aux = NULL;</pre></code>
<div><b><i>&lt;&lt;funcdefs&gt;&gt;=</i></b></div><pre><code>void orgparse_set_aux(orgparse *op, orgparse_text f);</pre></code>
<div><b><i>&lt;&lt;functions&gt;&gt;=</i></b></div><pre><code>void orgparse_set_aux(orgparse *op, orgparse_text f)
{
    op-&gt;aux = f;
}</pre></code>

<h4>5.2.9. Newline</h4>

<p><a id="wm_007_0322"></a>The newline callback gets called anytime there is an empty
line, which means an explicit line break is needed.
For convenience, the <code>orgparse_text</code> callback is used,
though the arguments will be unused and set to <code>NULL</code>.
<div><b><i>&lt;&lt;interface&gt;&gt;=</i></b></div><pre><code>orgparse_text newline;</pre></code>
<div><b><i>&lt;&lt;init&gt;&gt;=</i></b></div><pre><code>op-&gt;newline = NULL;</pre></code>
<div><b><i>&lt;&lt;funcdefs&gt;&gt;=</i></b></div><pre><code>void orgparse_set_newline(orgparse *op, orgparse_text f);</pre></code>
<div><b><i>&lt;&lt;functions&gt;&gt;=</i></b></div><pre><code>void orgparse_set_newline(orgparse *op, orgparse_text f)
{
    op-&gt;newline = f;
}</pre></code>

<h4>5.2.10. Name</h4>

<p><a id="wm_007_0332"></a>Handles a 'NAME' command.
<div><b><i>&lt;&lt;interface&gt;&gt;=</i></b></div><pre><code>orgparse_text name;</pre></code>
<div><b><i>&lt;&lt;init&gt;&gt;=</i></b></div><pre><code>op-&gt;name = NULL;</pre></code>
<div><b><i>&lt;&lt;funcdefs&gt;&gt;=</i></b></div><pre><code>void orgparse_set_name(orgparse *op, orgparse_text f);</pre></code>
<div><b><i>&lt;&lt;functions&gt;&gt;=</i></b></div><pre><code>void orgparse_set_name(orgparse *op, orgparse_text f)
{
    op-&gt;name = f;
}</pre></code>

<h4>5.2.11. Title</h4>

<p><a id="wm_007_0342"></a>Handles a titlecommand.
<div><b><i>&lt;&lt;interface&gt;&gt;=</i></b></div><pre><code>orgparse_text title;</pre></code>
<div><b><i>&lt;&lt;init&gt;&gt;=</i></b></div><pre><code>op-&gt;title = NULL;</pre></code>
<div><b><i>&lt;&lt;funcdefs&gt;&gt;=</i></b></div><pre><code>void orgparse_set_title(orgparse *op, orgparse_text f);</pre></code>
<div><b><i>&lt;&lt;functions&gt;&gt;=</i></b></div><pre><code>void orgparse_set_title(orgparse *op, orgparse_text f)
{
    op-&gt;title = f;
}</pre></code>

<h4>5.2.12. Link</h4>

<p><a id="wm_007_0352"></a><div><b><i>&lt;&lt;typedefs&gt;&gt;=</i></b></div><pre><code>typedef void (*orgparse_link)(void *,
                              const char *,
                              size_t,
                              const char *,
                              size_t);</pre></code>
<div><b><i>&lt;&lt;interface&gt;&gt;=</i></b></div><pre><code>orgparse_link link;</pre></code>
<div><b><i>&lt;&lt;init&gt;&gt;=</i></b></div><pre><code>op-&gt;link = NULL;</pre></code>
<div><b><i>&lt;&lt;funcdefs&gt;&gt;=</i></b></div><pre><code>void orgparse_set_link(orgparse *op, orgparse_link f);</pre></code>
<div><b><i>&lt;&lt;functions&gt;&gt;=</i></b></div><pre><code>void orgparse_set_link(orgparse *op, orgparse_link f)
{
    op-&gt;link = f;
}</pre></code>

<h4>5.2.13. Paragraph</h4>

<p><a id="wm_007_0363"></a>The pargraph callback gets called anytime a paragraph block
starts or end. For HTML generation, this will be in charge
of generating p-tags.
</p>
<p>A paragraph starts when a new text block begins, and ends
with a line break, or major mode change (such as for a code
block or header).
<div><b><i>&lt;&lt;typedefs&gt;&gt;=</i></b></div><pre><code>typedef void (*orgparse_pgrph)(void *, int);</pre></code>
<div><b><i>&lt;&lt;interface&gt;&gt;=</i></b></div><pre><code>orgparse_pgrph pgrph;</pre></code>
<div><b><i>&lt;&lt;init&gt;&gt;=</i></b></div><pre><code>op-&gt;pgrph = NULL;</pre></code>
<div><b><i>&lt;&lt;funcdefs&gt;&gt;=</i></b></div><pre><code>void orgparse_set_pgrph(orgparse *op, orgparse_pgrph f);</pre></code>
<div><b><i>&lt;&lt;functions&gt;&gt;=</i></b></div><pre><code>void orgparse_set_pgrph(orgparse *op, orgparse_pgrph f)
{
    op-&gt;pgrph = f;
}</pre></code>
<p></p>
<p>A paragraph begins with <code>orgparse_pgrph_begin</code>.
A paragraph ends with <code>orgparse_pgrph_end</code>.
Note that neither of these functions actually check to see
if they are <b>supposed</b> to be beginning or ending. That logic
is done elsewhere.
</p>
<div><b><i>&lt;&lt;funcdefs&gt;&gt;=</i></b></div><pre><code>void orgparse_pgrph_begin(orgparse *op, void *ud);
void orgparse_pgrph_end(orgparse *op, void *ud);</pre></code>
<div><b><i>&lt;&lt;functions&gt;&gt;=</i></b></div><pre><code>void orgparse_pgrph_begin(orgparse *op, void *ud)
{
    if (op-&gt;pgrph != NULL) {
        op-&gt;pgrph(ud, 0);
    }
}

void orgparse_pgrph_end(orgparse *op, void *ud)
{
    if (op-&gt;pgrph != NULL) {
        op-&gt;pgrph(ud, 1);
    }
}</pre></code>
<p></p>
<p>Paragraphs do not end at the end of a file. It will need to
be ended explicitely. This used to be done with a function
called <code>orgparse_wrapup</code>, which worked by checking a return
flag and adding a paragraph. This ended up being too
simplistic and limiting, and has since been removed..
</p>
<p>A new version of <code>orgparse_wrapup</code> is used, this time taking
in an <code>orgparse_state</code> variable. We'll call it
<code>orgparse_end</code>.
</p>
<p>This was created because the single rc flag (txtmode) alone
was giving some false positives, and rogue paragraph ends
were happening.
</p>
<p>This new function checks both the <code>txtmode</code>
and <code>newline</code> flags. A paragraph end will only happen when
the <code>newline</code> flag is not set.
</p>
<div><b><i>&lt;&lt;funcdefs&gt;&gt;=</i></b></div><pre><code>void orgparse_end(orgparse *op,
                  void *ud,
                  orgparse_state *state);</pre></code>
<div><b><i>&lt;&lt;functions&gt;&gt;=</i></b></div><pre><code>void orgparse_end(orgparse *op,
                  void *ud,
                  orgparse_state *state)
{
    int rc;
    rc =
        state-&gt;flags-&gt;txtmode &&
        state-&gt;flags-&gt;newline == 0;

    if (rc) {
        orgparse_pgrph_end(op, ud);
    }
}</pre></code>
<p></p>
<br>
<p><hr>

<a href="/loom/wm_007_0098">prev</a> | <a href="/loom/orgparse">home</a> | <a href="/loom/wm_007_0385">next</a></p>
</div>
</body>
</html>
