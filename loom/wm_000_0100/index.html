<!DOCTYPE html>
<html lang="en">
<head>

<meta charset="utf-8">
<link rel="stylesheet" href="/css/style.css">

</head>
<body>
<div id="main">

<h3>4. The Region</h3>

<p><a id="wm_000_0100"></a>Regions are rectangular spaces to draw stuff into.
</p>
<div><b><i>&lt;&lt;typedefs&gt;&gt;=</i></b></div><pre><code>typedef struct btprnt_region btprnt_region;</pre></code>
<p></p>
<p>A region provides two main things: a local coordinate
space, and rectangular clipping.
</p>
<p>A region contains the top left coordinate position,
the region width, and the region height.
</p>
<p>Because of how important regions for user level
operations, this struct is actually exposed in
the public header, allowing for instances to be allocated
on the stack instead of the heap.
</p>
<div><b><i>&lt;&lt;btprnt_region_struct&gt;&gt;=</i></b></div><pre><code>struct btprnt_region {
    btprnt_canvas *c;
    int w, h;
    int x, y;
};</pre></code>
<p></p>
<p>A new region is created with <code>btprnt_region_new</code>.
</p>
<div><b><i>&lt;&lt;funcdefs&gt;&gt;=</i></b></div><pre><code>btprnt_region * btprnt_region_new(btprnt_canvas *c,
                                  int x, int y,
                                  int w, int h);</pre></code>
<div><b><i>&lt;&lt;funcs&gt;&gt;=</i></b></div><pre><code>btprnt_region * btprnt_region_new(btprnt_canvas *c,
                                  int x, int y,
                                  int w, int h)
{
    btprnt_region *r;

    r = calloc(1, sizeof(btprnt_region));

    if (r == NULL) return NULL;

    btprnt_region_init(c, r, x, y, w, h);

    return r;
}</pre></code>
<p></p>
<p>It is freed with <code>btprnt_region_del</code>.
</p>
<div><b><i>&lt;&lt;funcdefs&gt;&gt;=</i></b></div><pre><code>void btprnt_region_del(btprnt_region **r);</pre></code>
<div><b><i>&lt;&lt;funcs&gt;&gt;=</i></b></div><pre><code>void btprnt_region_del(btprnt_region **r)
{
    if (*r == NULL) return;
    free(*r);
    *r = NULL;
}</pre></code>
<p></p>
<p>If a region is to be allocated on the stack, it needs
only to be initialized. This can be done with
<code>btprnt_region_init</code>.
</p>
<div><b><i>&lt;&lt;funcdefs&gt;&gt;=</i></b></div><pre><code>void btprnt_region_init(btprnt_canvas *c,
                        btprnt_region *r,
                        int x, int y,
                        int w, int h);</pre></code>
<div><b><i>&lt;&lt;funcs&gt;&gt;=</i></b></div><pre><code>void btprnt_region_init(btprnt_canvas *c,
                        btprnt_region *r,
                        int x, int y,
                        int w, int h)
{
    btprnt_region_xpos_set(r, x);
    btprnt_region_ypos_set(r, y);
    btprnt_region_width_set(r, w);
    btprnt_region_height_set(r, h);
    r-&gt;c = c;
}</pre></code>
<p></p>
<p>The dimensions and position can be changed after it is
instantiated.
</p>
<div><b><i>&lt;&lt;funcdefs&gt;&gt;=</i></b></div><pre><code>void btprnt_region_xpos_set(btprnt_region *r, int x);
void btprnt_region_ypos_set(btprnt_region *r, int y);
void btprnt_region_width_set(btprnt_region *r, int w);
void btprnt_region_height_set(btprnt_region *r, int h);</pre></code>
<div><b><i>&lt;&lt;funcs&gt;&gt;=</i></b></div><pre><code>void btprnt_region_xpos_set(btprnt_region *r, int x)
{
    r-&gt;x = x;
}

void btprnt_region_ypos_set(btprnt_region *r, int y)
{
    r-&gt;y = y;
}

void btprnt_region_width_set(btprnt_region *r, int w)
{
    r-&gt;w = w;
}

void btprnt_region_height_set(btprnt_region *r, int h)
{
    r-&gt;h = h;
}</pre></code>
<p></p>
<p>Drawing utilities write to a region. The region ensures that
the pixel is not being written beyond the bounds of itself.
The actual placement on the buffer is handled via a canvas.
</p>
<div><b><i>&lt;&lt;funcdefs&gt;&gt;=</i></b></div><pre><code>void btprnt_region_draw(btprnt_region *r,
                        int x, int y,
                        int c);</pre></code>
<p>For now, this function will be a little bit overpowered. In
the future, it might be better to break this up into
different components and flesh out the canvas interface.
<div><b><i>&lt;&lt;funcs&gt;&gt;=</i></b></div><pre><code>void btprnt_region_draw(btprnt_region *r,
                        int x, int y,
                        int c)
{
    btprnt_canvas *cv;
    int gx, gy;

    cv = r-&gt;c;

    if (x &lt; 0 || x &gt;= r-&gt;w) return;
    if (y &lt; 0 || y &gt;= r-&gt;h) return;

    gx = cv-&gt;offx + r-&gt;x + x;
    if (gx &lt; 0 || gx &gt;= cv-&gt;buf-&gt;w) return;
    gy = cv-&gt;offy + r-&gt;y + y;
    if (gy &lt; 0 || gy &gt;= cv-&gt;buf-&gt;h) return;

    btprnt_buf_write(cv-&gt;buf, gx, gy, c);
}</pre></code>
</div>
</body>
</html>
