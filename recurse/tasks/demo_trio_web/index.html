<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<link rel="stylesheet" href="/recurse/css/style.css">
<meta name="viewport" content="width=device-width,initial-scale=1" />
</head>
<body>
<div id="main">
<p><title>Build initial web port of trio</title>
<h1>Build initial web port of trio</h1>
task id: demo-trio-web
</p>
<p><a href="#2024_07_29_15_17" id="2024_07_29_15_17">2024-07-29 15:17</a>: Begin initial web port #demo-trio-web</p>
<p><a href="#2024_07_29_15_20" id="2024_07_29_15_20">2024-07-29 15:20</a>: Writing out boilerplate HTML/js #demo-trio-web #timelog:00:36:46</p>
<div class="comment-block">
<p>Doing this by hand, as a learning experience. Poke used as reference. 
</p>
<p> I am using "modules" now to help me better break up my code ahead of time.
</p>
</div>
<p><a href="#2024_07_29_16_07" id="2024_07_29_16_07">2024-07-29 16:07</a>: initial webaudio scaffolding #demo-trio-web #timelog:00:38:01</p>
<p><a href="#2024_07_29_16_31" id="2024_07_29_16_31">2024-07-29 16:31</a>: What's a good way to get sound/visuals to talk? #demo-trio-web</p>
<div class="comment-block">
<p>Trying to do this the mildly correct way. 
</p>
<p> I'm making a new class off of p5, adding my own data to it.
</p>
</div>
<p><a href="#2024_07_29_16_41" id="2024_07_29_16_41">2024-07-29 16:41</a>: Adding intial processor code #demo-trio-web</p>
<div class="comment-block">
<p>No WASM bits yet, though there should be placeholder
</p>
</div>
<p><a href="#2024_07_29_16_45" id="2024_07_29_16_45">2024-07-29 16:45</a>: That's all we have time for. #demo-trio-web</p>
<div class="comment-block">
<p>Wrapping up this session.
</p>
</div>
<p><a href="#2024_07_29_19_07" id="2024_07_29_19_07">2024-07-29 19:07</a>: More web porting #demo-trio-web #timelog:01:51:28</p>
<p><a href="#2024_07_29_19_09" id="2024_07_29_19_09">2024-07-29 19:09</a>: I'm turning this into a typescript project. #demo-trio-web</p>
<div class="comment-block">
<p>Using this guide: &lt;&lt;<a href="#">/digitalocean_typescript_new_project</a>&gt;&gt;. 
</p>
<p> npm -i typescript --save-dev 
</p>
<br>
<br>
</div>
<p><a href="#2024_07_29_19_17" id="2024_07_29_19_17">2024-07-29 19:17</a>: I am fighting the code formatter #demo-trio-web</p>
<div class="comment-block">
<br>
<br>
<p> npm i gts --save-dev 
</p>
<p> npx gts init 
</p>
<p> This seems to solve the formatter 
</p>
<p> npx tsc
</p>
</div>
<p><a href="#2024_07_29_19_32" id="2024_07_29_19_32">2024-07-29 19:32</a>: you know what on second thought, just keep on doing JS I'm tired #demo-trio-web</p>
<p><a href="#2024_07_29_19_49" id="2024_07_29_19_49">2024-07-29 19:49</a>: I just lost my main work. This sucks. #demo-trio-web</p>
<div class="comment-block">
<p>Accidentally deleted sketch.js. 
</p>
<p> Might as well try typescript again.
</p>
</div>
<p><a href="#2024_07_29_20_20" id="2024_07_29_20_20">2024-07-29 20:20</a>: p5 does not want to play nice with typescript #demo-trio-web</p>
<p><a href="#2024_07_29_20_28" id="2024_07_29_20_28">2024-07-29 20:28</a>: great, now I'm looking at the p5 codebase #demo-trio-web</p>
<p><a href="#2024_07_29_20_50" id="2024_07_29_20_50">2024-07-29 20:50</a>: "npm test" generates the p5.min.js file great #demo-trio-web</p>
<div class="comment-block">
<p>There is literally one line that is the issue. I am going to attempt to patch this on my end.
</p>
</div>
<p><a href="#2024_07_29_21_08" id="2024_07_29_21_08">2024-07-29 21:08</a>: let the record show: we tried to get p5 working. #demo-trio-web</p>
<p><a href="#2024_07_30_08_01" id="2024_07_30_08_01">2024-07-30 08:01</a>: Just do the graphics in canvas instead of p5? #demo-trio-web</p>
<div class="comment-block">
<p>R mentioned this, and it's been a sentiment that others have mentioned as well. p5 just makes canvas calls anyways.
</p>
</div>
<p><a href="#2024_07_30_08_07" id="2024_07_30_08_07">2024-07-30 08:07</a>: Get something working using canvas API #demo-trio-web #timelog:01:34:07</p>
<p><a href="#2024_07_30_08_56" id="2024_07_30_08_56">2024-07-30 08:56</a>: Trying to get pointer logic working. #demo-trio-web</p>
<div class="comment-block">
<p>Following &lt;&lt;<a href="/recurse/dz/webdev#using_pointer_events">webdev/using_pointer_events</a>&gt;&gt;. 
</p>
<p> Issue was a chrome mobile related issue. Had to use CSS to set <code>touch-actions</code> to be <code>none</code>.
</p>
</div>
<p><a href="#2024_07_30_09_35" id="2024_07_30_09_35">2024-07-30 09:35</a>: Setting up dynamic lines layout #demo-trio-web</p>
<p><a href="#2024_07_30_09_43" id="2024_07_30_09_43">2024-07-30 09:43</a>: Okay visuals are off to a good start now. #demo-trio-web</p>
<p><a href="#2024_07_30_09_48" id="2024_07_30_09_48">2024-07-30 09:48</a>: Begin work making audioworklet stuff #demo-trio-web #timelog:01:02:25</p>
<div class="comment-block">
<p>Once again...
</p>
</div>
<p><a href="#2024_07_30_09_50" id="2024_07_30_09_50">2024-07-30 09:50</a>: turning things into a module #demo-trio-web</p>
<div class="comment-block">
<p>Interesting, the parser becomes stricter. I need to formally declare "i" in my for loop. All done by simply add "type=module" to my HTML script element.
</p>
</div>
<p><a href="#2024_07_30_10_13" id="2024_07_30_10_13">2024-07-30 10:13</a>: click to start mechanics not behaving for some reason #demo-trio-web</p>
<div class="comment-block">
<p>Figured it out: it was the callback mechanics of requestAnimationFrame.
</p>
</div>
<p><a href="#2024_07_30_10_16" id="2024_07_30_10_16">2024-07-30 10:16</a>: adding "TAP TO BEGIN" text. #demo-trio-web</p>
<p><a href="#2024_07_30_10_27" id="2024_07_30_10_27">2024-07-30 10:27</a>: setting up message passing to worklet #demo-trio-web</p>
<p><a href="#2024_07_30_10_30" id="2024_07_30_10_30">2024-07-30 10:30</a>: first getting the input events to the node #demo-trio-web</p>
<p><a href="#2024_07_30_10_38" id="2024_07_30_10_38">2024-07-30 10:38</a>: startAudio returns a promise I guess? #demo-trio-web</p>
<div class="comment-block">
<p>Solution: encapsulate in <code>then</code>.
</p>
</div>
<p><a href="#2024_07_30_10_43" id="2024_07_30_10_43">2024-07-30 10:43</a>: move message works! #demo-trio-web</p>
<p><a href="#2024_07_30_10_47" id="2024_07_30_10_47">2024-07-30 10:47</a>: send to processor via messages now #demo-trio-web</p>
<p><a href="#2024_07_30_10_51" id="2024_07_30_10_51">2024-07-30 10:51</a>: initial message passing implemented #demo-trio-web</p>
<div class="comment-block">
<p>I'll have to do the rest later.
</p>
</div>
<p><a href="#2024_07_30_13_17" id="2024_07_30_13_17">2024-07-30 13:17</a>: More audioworklet stuff #demo-trio-web #timelog:02:51:07</p>
<p><a href="#2024_07_30_13_21" id="2024_07_30_13_21">2024-07-30 13:21</a>: Why is gate not being read in chromium #demo-trio-web</p>
<div class="comment-block">
<p>I'm mouse events are happening either way 
</p>
<p> Logic bug. And should have been an or. Struggled to clear cache on Chromium too.
</p>
</div>
<p><a href="#2024_07_30_13_27" id="2024_07_30_13_27">2024-07-30 13:27</a>: Get wasm stuff working #demo-trio-web</p>
<p><a href="#2024_07_30_13_29" id="2024_07_30_13_29">2024-07-30 13:29</a>: My println stuff is causing issues I think. #demo-trio-web</p>
<div class="comment-block">
<p>I'm not going to do macros, I'm just going to comment things out.
</p>
</div>
<p><a href="#2024_07_30_13_37" id="2024_07_30_13_37">2024-07-30 13:37</a>: Huh. it's not generating a wasm at all actually, even though there is no error. #demo-trio-web</p>
<div class="comment-block">
<p>Had to generate cdylib.
</p>
</div>
<p><a href="#2024_07_30_13_43" id="2024_07_30_13_43">2024-07-30 13:43</a>: More unknown opcodes in wasm-gc. I wonder if there's a way to get more info on that #demo-trio-web</p>
<div class="comment-block">
<p>It went from unknown opcode 192 to 193, after I commented out all the panics.
</p>
</div>
<p><a href="#2024_07_30_13_50" id="2024_07_30_13_50">2024-07-30 13:50</a>: broke the tests last night with more notes I think #demo-trio-web</p>
<div class="comment-block">
<p>Nope, that wasn't it. Sigh. Gotta bisect. 
</p>
<p> Bisect tracked down the quick bugfix I made that checked for valid lower/upper values.
</p>
</div>
<p><a href="#2024_07_30_14_21" id="2024_07_30_14_21">2024-07-30 14:21</a>: A messy fix for now, but things don't panic and tests pass #demo-trio-web</p>
<p><a href="#2024_07_30_14_27" id="2024_07_30_14_27">2024-07-30 14:27</a>: A very odd opcode was generated in wasm #demo-trio-web</p>
<div class="comment-block">
<p>Opcode 193 is something that extends a signed opcode, which caused wasm-gc to panic. The lines that do that are in the <code>measure_movement</code> function. It was quick to find because it's the only time I deliberately cast from unsigned to signed. I happened to use i16 which caused the panic to happen. However, changing to i32 made things work just fine.
</p>
</div>
<p><a href="#2024_07_30_14_31" id="2024_07_30_14_31">2024-07-30 14:31</a>: right. Now I need to get the wasm in. #demo-trio-web</p>
<div class="comment-block">
<p>The exports and the interface are already there from the C prototype. It should mostly drop right in.
</p>
</div>
<p><a href="#2024_07_30_15_00" id="2024_07_30_15_00">2024-07-30 15:00</a>: There should be sound. But there is no sound. #demo-trio-web</p>
<p><a href="#2024_07_30_15_25" id="2024_07_30_15_25">2024-07-30 15:25</a>: Still not sure where there isn't sound. #demo-trio-web</p>
<p><a href="#2024_07_30_15_28" id="2024_07_30_15_28">2024-07-30 15:28</a>: I forgot to return true, but there still ain't any sound. #demo-trio-web</p>
<p><a href="#2024_07_30_15_46" id="2024_07_30_15_46">2024-07-30 15:46</a>: Okay, now there's sound. #demo-trio-web</p>
<div class="comment-block">
<p>I wasn't passing in the dsp parameter.
</p>
</div>
<p><a href="#2024_07_30_15_47" id="2024_07_30_15_47">2024-07-30 15:47</a>: Attempting to run on phone. #demo-trio-web</p>
<p><a href="#2024_07_30_16_11" id="2024_07_30_16_11">2024-07-30 16:11</a>: Good enough. Taking a break. #demo-trio-web</p>
</div>
</body>
</html>
