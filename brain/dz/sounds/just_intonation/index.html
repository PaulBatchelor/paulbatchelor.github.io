<!DOCTYPE html>
<html lang="en">
<head>

<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="/brain/css/style.css">

</head>
<body>
<div id="main">
<p><title>sounds/just_intonation</title>
<h1>just_intonation</h1>
<a href="/brain/dz">dz</a> / <a href="/brain/dz/sounds">sounds</a> / <a href="/brain/dz/sounds/just_intonation">just_intonation</a>
<p></p>
<h2>Summary</h2>
<p>
Experiments with Just Intonation
</p>
<h2>Node Tree</h2>
<ul>
<li>
<a href=#motivations>motivations</a><ul>
<li>
<a href=#ringing_chords>ringing_chords</a><ul>
<li>
<a href=#stretchy_intonation_ensembles>stretchy_intonation_ensembles</a><ul>
<li>
<a href=#interpolation>interpolation</a><ul>
<li>
<a href=#octave_wrapping>octave_wrapping</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>
<a href=#vox_blending>vox_blending</a><ul>
<li>
<a href=#graindelavoix_gesualdo>graindelavoix_gesualdo</a></li>
</ul>
</li>
</ul>
</li>
<li>
<a href=#algorithm>algorithm</a><ul>
<li>
<a href=#diatonic_only>diatonic_only</a></li>
<li>
<a href=#implementation>implementation</a><ul>
<li>
<a href=#inputs>inputs</a><ul>
<li>
<a href=#stretchy_intonation_ensembles>stretchy_intonation_ensembles</a><ul>
<li>
<a href=#interpolation>interpolation</a><ul>
<li>
<a href=#octave_wrapping>octave_wrapping</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>
<a href=#sound_examples>sound_examples</a><ul>
<li>
<a href=#saws_et_ji>saws_et_ji</a><ul>
<li>
<a href=#vox_et_ji>vox_et_ji</a><ul>
<li>
<a href=#metallic_explanation>metallic_explanation</a></li>
</ul>
</li>
</ul>
</li>
<li>
<a href=#vox_et_ji>vox_et_ji</a><ul>
<li>
<a href=#metallic_explanation>metallic_explanation</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>
<a href=#interpolation>interpolation</a><ul>
<li>
<a href=#octave_wrapping>octave_wrapping</a></li>
</ul>
</li>
<li>
<a href=#stretchy_intonation_ensembles>stretchy_intonation_ensembles</a><ul>
<li>
<a href=#interpolation>interpolation</a><ul>
<li>
<a href=#octave_wrapping>octave_wrapping</a></li>
</ul>
</li>
</ul>
</li>
<li>
<a href=#base_and_multiplier>base_and_multiplier</a><ul>
<li>
<a href=#diatonic_mapping>diatonic_mapping</a><ul>
<li>
<a href=#dialut>dialut</a><ul>
<li>
<a href=#octave_wrapping>octave_wrapping</a></li>
</ul>
</li>
</ul>
</li>
<li>
<a href=#ratios>ratios</a><ul>
<li>
<a href=#octave_wrapping>octave_wrapping</a></li>
</ul>
</li>
<li>
<a href=#base_frequency_includes_octave>base_frequency_includes_octave</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<h2>Nodes</h2>
<table border="1px">
<tr>
<td colspan=2>
<a href=#motivations>motivations</a><a id="motivations"></a>
</td>
</tr>
<tr>
<td>
content
</td>
<td>
motivations for JI
</td>
</tr>
<tr>
<td>
children
</td>
<td>
<a href=#ringing_chords>ringing_chords</a>, <a href=#vox_blending>vox_blending</a>
</td>
</tr>
</table><br>
<table border="1px">
<tr>
<td colspan=2>
<a href=#vox_blending>vox_blending</a><a id="vox_blending"></a>
</td>
</tr>
<tr>
<td>
content
</td>
<td>
My hopes for working with JI is in the context of vocal synthesis. I was inspired by a video I saw of the vocal ensemble Graindelavoix perform Gesualdo. Their blending was amazing, and I thought it might have something to do with their intonation. Since fretless ensembles tune chords to ring, I figured it was the natural inclination for the intonation scheme to be more just intonation than equal temperament
</td>
</tr>
<tr>
<td>
children
</td>
<td>
<a href=#graindelavoix_gesualdo>graindelavoix_gesualdo</a> (inspiration for thinking about JI)
</td>
</tr>
<tr>
<td>
parents
</td>
<td>
<a href=#motivations>motivations</a>
</td>
</tr>
</table><br>
<table border="1px">
<tr>
<td colspan=2>
<a href=#graindelavoix_gesualdo>graindelavoix_gesualdo</a><a id="graindelavoix_gesualdo"></a>
</td>
</tr>
<tr>
<td>
content
</td>
<td>
Carlo Gesualdo, Plange Quasi Virgo (Tenebrae Responsoria), GRAINDELAVOIX 
</td>
</tr>
<tr>
<td>
parents
</td>
<td>
<a href=#vox_blending>vox_blending</a>
</td>
</tr>
<tr>
<td>
hyperlink
</td>
<td>
<a href="https://www.youtube.com/watch?v=IfOQICfimJE">https://www.youtube.com/watch?v=IfOQICfimJE</a>
</td>
</tr>
</table><br>
<table border="1px">
<tr>
<td colspan=2>
<a href=#algorithm>algorithm</a><a id="algorithm"></a>
</td>
</tr>
<tr>
<td>
content
</td>
<td>
A Just Intonation algorithm for converting MIDI notes into JI frequencies.
</td>
</tr>
<tr>
<td>
children
</td>
<td>
<a href=#diatonic_only>diatonic_only</a>, <a href=#implementation>implementation</a> (C implementation on sourcehut), <a href=#interpolation>interpolation</a>, <a href=#stretchy_intonation_ensembles>stretchy_intonation_ensembles</a>, <a href=#base_and_multiplier>base_and_multiplier</a>
</td>
</tr>
</table><br>
<table border="1px">
<tr>
<td colspan=2>
<a href=#implementation>implementation</a><a id="implementation"></a>
</td>
</tr>
<tr>
<td>
content
</td>
<td>
JI implementation (sndkit/mnolth node via mnodes)
</td>
</tr>
<tr>
<td>
children
</td>
<td>
<a href=#inputs>inputs</a>, <a href=#sound_examples>sound_examples</a>
</td>
</tr>
<tr>
<td>
parents
</td>
<td>
<a href=#algorithm>algorithm</a>
</td>
</tr>
<tr>
<td>
hyperlink
</td>
<td>
<a href="https://git.sr.ht/~pbatch/mnodes/tree/master/item/ji/ji.c">https://git.sr.ht/~pbatch/mnodes/tree/master/item/ji/ji.c</a>
</td>
</tr>
</table><br>
<table border="1px">
<tr>
<td colspan=2>
<a href=#inputs>inputs</a><a id="inputs"></a>
</td>
</tr>
<tr>
<td>
content
</td>
<td>
Inputs: a MIDI note number, and a key (0-11)
</td>
</tr>
<tr>
<td>
children
</td>
<td>
<a href=#stretchy_intonation_ensembles>stretchy_intonation_ensembles</a> (continously controlled fractional inputs for stretchiness)
</td>
</tr>
<tr>
<td>
parents
</td>
<td>
<a href=#implementation>implementation</a>
</td>
</tr>
</table><br>
<table border="1px">
<tr>
<td colspan=2>
<a href=#diatonic_only>diatonic_only</a><a id="diatonic_only"></a>
</td>
</tr>
<tr>
<td>
content
</td>
<td>
Strictly speaking, there is no such thing as a non-diatonic note in this system. The only actual pitches available are 7 scale degrees available in the current base key. Non-diatonic pitches are considered in-between two diatonic pitches, and interpolation is used to compute those frequencies.
</td>
</tr>
<tr>
<td>
parents
</td>
<td>
<a href=#algorithm>algorithm</a>
</td>
</tr>
</table><br>
<table border="1px">
<tr>
<td colspan=2>
<a href=#stretchy_intonation_ensembles>stretchy_intonation_ensembles</a><a id="stretchy_intonation_ensembles"></a>
</td>
</tr>
<tr>
<td>
content
</td>
<td>
By having continuous control of key and pitch, the idea was that a lyrically performed sound such as the voice could have a degree of stretchiness in the pitches. This would allow an ensemble of voices to perform ringing chords in multiple keys
</td>
</tr>
<tr>
<td>
children
</td>
<td>
<a href=#interpolation>interpolation</a>
</td>
</tr>
<tr>
<td>
parents
</td>
<td>
<a href=#inputs>inputs</a>, <a href=#algorithm>algorithm</a>, <a href=#ringing_chords>ringing_chords</a>
</td>
</tr>
</table><br>
<table border="1px">
<tr>
<td colspan=2>
<a href=#ringing_chords>ringing_chords</a><a id="ringing_chords"></a>
</td>
</tr>
<tr>
<td>
content
</td>
<td>
Ringing Chords
</td>
</tr>
<tr>
<td>
children
</td>
<td>
<a href=#stretchy_intonation_ensembles>stretchy_intonation_ensembles</a> (stretch to ring chords in multiple keys)
</td>
</tr>
<tr>
<td>
parents
</td>
<td>
<a href=#motivations>motivations</a>
</td>
</tr>
</table><br>
<table border="1px">
<tr>
<td colspan=2>
<a href=#sound_examples>sound_examples</a><a id="sound_examples"></a>
</td>
</tr>
<tr>
<td>
content
</td>
<td>
Sound Examples
</td>
</tr>
<tr>
<td>
children
</td>
<td>
<a href=#saws_et_ji>saws_et_ji</a>, <a href=#vox_et_ji>vox_et_ji</a>
</td>
</tr>
<tr>
<td>
parents
</td>
<td>
<a href=#implementation>implementation</a>
</td>
</tr>
</table><br>
<table border="1px">
<tr>
<td colspan=2>
<a href=#saws_et_ji>saws_et_ji</a><a id="saws_et_ji"></a>
</td>
</tr>
<tr>
<td>
content
</td>
<td>
A subtractive sawtooth patch, first performing in equal temperament, then in just intonation. In the ET patch there is beating, while with JI the pitches  are dead on. The difference in sound is not subtle.
</td>
</tr>
<tr>
<td>
children
</td>
<td>
<a href=#vox_et_ji>vox_et_ji</a> (iteration: from saws to vocal synthesizers)
</td>
</tr>
<tr>
<td>
parents
</td>
<td>
<a href=#sound_examples>sound_examples</a>
</td>
</tr>
<tr>
<td>
audio
</td>
<td>
<audio controls><source src="/res/brain/dz/et_ji.mp3"><audio>
</td>
</tr>
</table><br>
<table border="1px">
<tr>
<td colspan=2>
<a href=#vox_et_ji>vox_et_ji</a><a id="vox_et_ji"></a>
</td>
</tr>
<tr>
<td>
content
</td>
<td>
A synthesized vocal ensemble playing a diatonic cluster chord, first using equal temperament, then using Just Intonation. In the ET version, there is that warbly beating sound which would be quite difficult and unnatural for a human vocal ensemble to perform. To my ears, they turn into sawtooth oscillators after a while. In the JI version, the voices blend much better. The sound is a little metallic, but I still think it's a step in the right direction. I'm hoping I'll be able to sand down some of the rough edges here.
</td>
</tr>
<tr>
<td>
children
</td>
<td>
<a href=#metallic_explanation>metallic_explanation</a> (Metallic ringing explanation)
</td>
</tr>
<tr>
<td>
parents
</td>
<td>
<a href=#saws_et_ji>saws_et_ji</a>, <a href=#sound_examples>sound_examples</a>
</td>
</tr>
<tr>
<td>
audio
</td>
<td>
<audio controls><source src="/res/brain/dz/vox_et_ji.mp3"><audio>
</td>
</tr>
</table><br>
<table border="1px">
<tr>
<td colspan=2>
<a href=#metallic_explanation>metallic_explanation</a><a id="metallic_explanation"></a>
</td>
</tr>
<tr>
<td>
content
</td>
<td>
I think the reason why there is a metallic quality to the voices has to do with the fact that the voices were basically copy-pasted from one another. Other than pitch, the voices are virtually identical to one another right down to the phase alignment.
</td>
</tr>
<tr>
<td>
parents
</td>
<td>
<a href=#vox_et_ji>vox_et_ji</a>
</td>
</tr>
</table><br>
<table border="1px">
<tr>
<td colspan=2>
<a href=#base_and_multiplier>base_and_multiplier</a><a id="base_and_multiplier"></a>
</td>
</tr>
<tr>
<td>
content
</td>
<td>
Just intonation boils down two a multiplication between a base frequency (in this case, determined from the input midi pitch and key and calculated using equal temperament), multiplied by a just intonation ratio.
</td>
</tr>
<tr>
<td>
children
</td>
<td>
<a href=#diatonic_mapping>diatonic_mapping</a>, <a href=#ratios>ratios</a>, <a href=#base_frequency_includes_octave>base_frequency_includes_octave</a>
</td>
</tr>
<tr>
<td>
parents
</td>
<td>
<a href=#algorithm>algorithm</a>
</td>
</tr>
</table><br>
<table border="1px">
<tr>
<td colspan=2>
<a href=#ratios>ratios</a><a id="ratios"></a>
</td>
</tr>
<tr>
<td>
content
</td>
<td>
Just Intonation Ratios: [1:1 (do), 9:8 (re), 5:4 (mi), 4:3 (fa), 3:2 (so), 5:3 (la), 15:8, 2:1 (do)]
</td>
</tr>
<tr>
<td>
children
</td>
<td>
<a href=#octave_wrapping>octave_wrapping</a> (The last element of the ratios is 2 for the next octave)
</td>
</tr>
<tr>
<td>
parents
</td>
<td>
<a href=#base_and_multiplier>base_and_multiplier</a>
</td>
</tr>
</table><br>
<table border="1px">
<tr>
<td colspan=2>
<a href=#dialut>dialut</a><a id="dialut"></a>
</td>
</tr>
<tr>
<td>
content
</td>
<td>
Map 12 semitones to 7 fractional diatonic tones: [0, 0.5, 1, 1.5, 2, 3, 3.5, 4, 4.5, 5, 5.5, 6, 7]. Note how there are larger jumps between 2 + 3 (mi and fa), and 6 and 7 (ti and do). These are where the halfsteps are in the major diatonic scale
</td>
</tr>
<tr>
<td>
children
</td>
<td>
<a href=#octave_wrapping>octave_wrapping</a>
</td>
</tr>
<tr>
<td>
parents
</td>
<td>
<a href=#diatonic_mapping>diatonic_mapping</a>
</td>
</tr>
</table><br>
<table border="1px">
<tr>
<td colspan=2>
<a href=#diatonic_mapping>diatonic_mapping</a><a id="diatonic_mapping"></a>
</td>
</tr>
<tr>
<td>
content
</td>
<td>
The input is still coming in as a MIDI note number in semitones, converted to a scale degree relative to the base note that is in range 0-11. In order to have it work with a JI ratio lookup table with interpolation, it needs to be  converted to a fractional value between 0 and 7. Computing the multiplier from a semitone value
</td>
</tr>
<tr>
<td>
children
</td>
<td>
<a href=#dialut>dialut</a>
</td>
</tr>
<tr>
<td>
parents
</td>
<td>
<a href=#base_and_multiplier>base_and_multiplier</a>
</td>
</tr>
</table><br>
<table border="1px">
<tr>
<td colspan=2>
<a href=#base_frequency_includes_octave>base_frequency_includes_octave</a><a id="base_frequency_includes_octave"></a>
</td>
</tr>
<tr>
<td>
content
</td>
<td>
The MIDI note number contains information about which octave the pitch is at, and this is used to compute the base frequency
</td>
</tr>
<tr>
<td>
parents
</td>
<td>
<a href=#base_and_multiplier>base_and_multiplier</a>
</td>
</tr>
</table><br>
<table border="1px">
<tr>
<td colspan=2>
<a href=#octave_wrapping>octave_wrapping</a><a id="octave_wrapping"></a>
</td>
</tr>
<tr>
<td>
content
</td>
<td>
Due to the interpolation logic, the algorithm needs to be able to wrap to above the octave. This is done by extending the lookup tables to include the second octave.
</td>
</tr>
<tr>
<td>
parents
</td>
<td>
<a href=#dialut>dialut</a>, <a href=#interpolation>interpolation</a>, <a href=#ratios>ratios</a>
</td>
</tr>
</table><br>
<table border="1px">
<tr>
<td colspan=2>
<a href=#interpolation>interpolation</a><a id="interpolation"></a>
</td>
</tr>
<tr>
<td>
content
</td>
<td>
linear interpolation is used to compute the frequency which allows notes to smoothly glide from one to another.
</td>
</tr>
<tr>
<td>
children
</td>
<td>
<a href=#octave_wrapping>octave_wrapping</a> (Octave wrapping)
</td>
</tr>
<tr>
<td>
parents
</td>
<td>
<a href=#stretchy_intonation_ensembles>stretchy_intonation_ensembles</a>, <a href=#algorithm>algorithm</a>
</td>
</tr>
</table><br>
</p>
</div>
</body>
</html>
